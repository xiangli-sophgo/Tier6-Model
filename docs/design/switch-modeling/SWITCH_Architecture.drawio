<mxfile host="65bd71144e">
    <diagram name="5.1 Switch Pipeline" id="sw1">
        <mxGraphModel dx="573" dy="35" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1100" pageHeight="650" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="title" value="&lt;b&gt;5.1 交换机内部处理流水线&lt;/b&gt;" style="text;html=1;align=center;fontSize=16;fontColor=#333;" parent="1" vertex="1">
                    <mxGeometry x="250" y="10" width="500" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="IBG" value="" style="rounded=1;fillColor=#E0F7FA;strokeColor=#00ACC1;dashed=1;" parent="1" vertex="1">
                    <mxGeometry x="30" y="60" width="500" height="250" as="geometry"/>
                </mxCell>
                <mxCell id="IL" value="&lt;b&gt;Ingress 入口处理&lt;/b&gt;" style="text;html=1;fontSize=12;fontColor=#00838F;" parent="1" vertex="1">
                    <mxGeometry x="45" y="65" width="160" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="PHY_RX" value="&lt;b&gt;PHY RX&lt;/b&gt;&lt;br&gt;SerDes 接收" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#B2EBF2;strokeColor=#00ACC1;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="50" y="95" width="130" height="44" as="geometry"/>
                </mxCell>
                <mxCell id="S1" value="&lt;b&gt;Stage 1: 帧解析&lt;/b&gt;&lt;br&gt;提取 MAC DA/SA&lt;br&gt;识别 EtherType/VLAN" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E0F7FA;strokeColor=#00ACC1;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="220" y="90" width="160" height="55" as="geometry"/>
                </mxCell>
                <mxCell id="S2" value="&lt;b&gt;Stage 2: QoS 分类&lt;/b&gt;&lt;br&gt;VLAN PCP / DSCP / 端口默认&lt;br&gt;-&gt; 优先级队列映射" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E0F7FA;strokeColor=#00ACC1;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="50" y="165" width="175" height="55" as="geometry"/>
                </mxCell>
                <mxCell id="S3" value="&lt;b&gt;Stage 3: MAC 查表&lt;/b&gt;&lt;br&gt;MAC DA -&gt; 出口端口&lt;br&gt;(无需解析 PAXI/RH)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E0F7FA;strokeColor=#00ACC1;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="260" y="165" width="160" height="55" as="geometry"/>
                </mxCell>
                <mxCell id="VOQ" value="&lt;b&gt;VOQ 入队&lt;/b&gt;&lt;br&gt;VOQ[in][out][pri]&lt;br&gt;DT 算法检查" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#BBDEFB;strokeColor=#1976D2;fontSize=11;shadow=1;" parent="1" vertex="1">
                    <mxGeometry x="160" y="250" width="160" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="ie1" style="strokeColor=#00838F;" parent="1" source="PHY_RX" target="S1" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="ie2" style="strokeColor=#00838F;" parent="1" source="S1" target="S2" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="ie3" style="strokeColor=#00838F;" parent="1" source="S1" target="S3" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="ie4" style="strokeColor=#1976D2;strokeWidth=2;" parent="1" source="S2" target="VOQ" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="ie5" style="strokeColor=#1976D2;strokeWidth=2;" parent="1" source="S3" target="VOQ" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="CBG" value="" style="rounded=1;fillColor=#FFF3E0;strokeColor=#F57C00;dashed=1;" parent="1" vertex="1">
                    <mxGeometry x="30" y="330" width="500" height="100" as="geometry"/>
                </mxCell>
                <mxCell id="CL" value="&lt;b&gt;Crossbar 交叉矩阵&lt;/b&gt;" style="text;html=1;fontSize=12;fontColor=#E65100;" parent="1" vertex="1">
                    <mxGeometry x="45" y="335" width="180" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="SCHED" value="&lt;b&gt;Stage 4: iSLIP 调度&lt;/b&gt;&lt;br&gt;Request -&gt; Grant -&gt; Accept&lt;br&gt;1~4 迭代/时间槽" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFE0B2;strokeColor=#F57C00;fontSize=10;shadow=1;" parent="1" vertex="1">
                    <mxGeometry x="50" y="365" width="190" height="55" as="geometry"/>
                </mxCell>
                <mxCell id="XBAR" value="&lt;b&gt;Stage 5: Crossbar 穿越&lt;/b&gt;&lt;br&gt;10~50 ns" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFE0B2;strokeColor=#F57C00;fontSize=10;shadow=1;" parent="1" vertex="1">
                    <mxGeometry x="290" y="365" width="190" height="55" as="geometry"/>
                </mxCell>
                <mxCell id="ce1" style="strokeColor=#F57C00;strokeWidth=2;" parent="1" source="VOQ" target="SCHED" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="ce2" style="strokeColor=#F57C00;strokeWidth=2;endArrow=block;endSize=8;" parent="1" source="SCHED" target="XBAR" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="EBG" value="" style="rounded=1;fillColor=#E8F5E9;strokeColor=#4CAF50;dashed=1;" parent="1" vertex="1">
                    <mxGeometry x="30" y="450" width="500" height="100" as="geometry"/>
                </mxCell>
                <mxCell id="EL" value="&lt;b&gt;Egress 出口处理&lt;/b&gt;" style="text;html=1;fontSize=12;fontColor=#2E7D32;" parent="1" vertex="1">
                    <mxGeometry x="45" y="455" width="140" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="S6" value="&lt;b&gt;Stage 6: 出口调度&lt;/b&gt;&lt;br&gt;SP + WRR 混合调度&lt;br&gt;ECN 标记 (仅 Standard)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#C8E6C9;strokeColor=#4CAF50;fontSize=10;shadow=1;" parent="1" vertex="1">
                    <mxGeometry x="50" y="485" width="190" height="55" as="geometry"/>
                </mxCell>
                <mxCell id="PHY_TX" value="&lt;b&gt;PHY TX&lt;/b&gt;&lt;br&gt;SerDes 发送" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#B2EBF2;strokeColor=#00ACC1;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="310" y="488" width="130" height="44" as="geometry"/>
                </mxCell>
                <mxCell id="ee1" style="strokeColor=#4CAF50;strokeWidth=2;" parent="1" source="XBAR" target="S6" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="ee2" style="strokeColor=#00838F;strokeWidth=2;" parent="1" source="S6" target="PHY_TX" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="FMT_L" value="&lt;b&gt;各格式对交换机的处理差异&lt;/b&gt;" style="text;html=1;fontSize=12;fontColor=#333;" parent="1" vertex="1">
                    <mxGeometry x="570" y="60" width="250" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="F1" value="&lt;b&gt;Standard&lt;/b&gt;&lt;br&gt;MAC+IP+UDP+RH (50B)&lt;br&gt;QoS: VLAN PCP / DSCP&lt;br&gt;ECN: [OK] 可标记&lt;br&gt;拥塞: ECN + PFC + CBFC" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E3F2FD;strokeColor=#1976D2;fontSize=10;align=left;spacingLeft=8;" parent="1" vertex="1">
                    <mxGeometry x="570" y="90" width="210" height="85" as="geometry"/>
                </mxCell>
                <mxCell id="F2" value="&lt;b&gt;AFH_GEN1/GEN2&lt;/b&gt;&lt;br&gt;AFH MAC+Eth+RH (22B)&lt;br&gt;QoS: VLAN PCP (可选)&lt;br&gt;ECN: [FAIL] 无 IP 头&lt;br&gt;拥塞: PFC + CBFC + Tail Drop" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF8E1;strokeColor=#d6b656;fontSize=10;align=left;spacingLeft=8;" parent="1" vertex="1">
                    <mxGeometry x="570" y="190" width="210" height="85" as="geometry"/>
                </mxCell>
                <mxCell id="F3" value="&lt;b&gt;AFH_Lite&lt;/b&gt;&lt;br&gt;AFH MAC only (12B)&lt;br&gt;QoS: 端口默认优先级&lt;br&gt;ECN: [FAIL] 无 IP 头&lt;br&gt;重传: [FAIL] Go-Back-N 关闭&lt;br&gt;拥塞: PFC + CBFC + Tail Drop" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFEBEE;strokeColor=#E53935;fontSize=10;align=left;spacingLeft=8;" parent="1" vertex="1">
                    <mxGeometry x="570" y="290" width="210" height="95" as="geometry"/>
                </mxCell>
                <mxCell id="FNOTE" value="&lt;i&gt;帧长: max ~1406B (远 &lt; 9000B Jumbo)&lt;br&gt;交换机只需处理标准以太网帧&lt;/i&gt;" style="text;html=1;fontSize=10;fontColor=#999;" parent="1" vertex="1">
                    <mxGeometry x="570" y="400" width="250" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="LAT_L" value="&lt;b&gt;延迟分解:&lt;/b&gt;  T_switch = T_ingress (50-200ns) + T_queueing (0~us) + T_crossbar (10-50ns) + T_egress (帧大小相关)" style="text;html=1;fontSize=11;fontColor=#555;align=center;" parent="1" vertex="1">
                    <mxGeometry x="50" y="570" width="700" height="22" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
    <diagram name="3.3 PFC Sequence" id="sw2">
        <mxGraphModel dx="573" dy="35" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="900" pageHeight="550" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="title" value="&lt;b&gt;3.3 PFC 流控交互时序 (交换机主动参与)&lt;/b&gt;" style="text;html=1;align=center;fontSize=15;fontColor=#333;" parent="1" vertex="1">
                    <mxGeometry x="150" y="10" width="500" height="28" as="geometry"/>
                </mxCell>
                <mxCell id="LA" value="&lt;b&gt;Chip A&lt;/b&gt;&lt;br&gt;(发送端 RC Link)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E3F2FD;strokeColor=#1976D2;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="80" y="50" width="150" height="44" as="geometry"/>
                </mxCell>
                <mxCell id="LS" value="&lt;b&gt;L2 Switch&lt;/b&gt;&lt;br&gt;端口 X" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF3E0;strokeColor=#F57C00;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="350" y="50" width="150" height="44" as="geometry"/>
                </mxCell>
                <mxCell id="LB" value="&lt;b&gt;Chip B&lt;/b&gt;&lt;br&gt;(接收端 PAXI RX)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#4CAF50;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="620" y="50" width="150" height="44" as="geometry"/>
                </mxCell>
                <mxCell id="LLA" value="" style="rounded=0;fillColor=#E3F2FD;strokeColor=#1976D2;strokeWidth=1;" parent="1" vertex="1">
                    <mxGeometry x="152" y="94" width="6" height="400" as="geometry"/>
                </mxCell>
                <mxCell id="LLS" value="" style="rounded=0;fillColor=#FFF3E0;strokeColor=#F57C00;strokeWidth=1;" parent="1" vertex="1">
                    <mxGeometry x="422" y="94" width="6" height="400" as="geometry"/>
                </mxCell>
                <mxCell id="LLB" value="" style="rounded=0;fillColor=#E8F5E9;strokeColor=#4CAF50;strokeWidth=1;" parent="1" vertex="1">
                    <mxGeometry x="692" y="94" width="6" height="400" as="geometry"/>
                </mxCell>
                <mxCell id="D1" value="Data" style="endArrow=block;strokeColor=#1976D2;fontSize=10;fontColor=#1976D2;" parent="1" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="158" y="140" as="sourcePoint"/>
                        <mxPoint x="422" y="140" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="D2" value="Data" style="endArrow=block;strokeColor=#F57C00;fontSize=10;fontColor=#F57C00;" parent="1" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="428" y="170" as="sourcePoint"/>
                        <mxPoint x="692" y="170" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="EV1" value="[!] RX Buffer &gt; 高水位" style="text;html=1;fontSize=10;fontColor=#E53935;fontStyle=3;align=center;" parent="1" vertex="1">
                    <mxGeometry x="620" y="195" width="170" height="18" as="geometry"/>
                </mxCell>
                <mxCell id="P1" value="PFC PAUSE" style="endArrow=block;strokeColor=#E53935;strokeWidth=2;fontSize=10;fontColor=#E53935;dashed=1;" parent="1" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="692" y="230" as="sourcePoint"/>
                        <mxPoint x="428" y="230" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="EV2" value="[!] 暂停向 B 发送" style="text;html=1;fontSize=10;fontColor=#F57C00;fontStyle=2;align=center;" parent="1" vertex="1">
                    <mxGeometry x="340" y="245" width="170" height="18" as="geometry"/>
                </mxCell>
                <mxCell id="P2" value="PFC PAUSE" style="endArrow=block;strokeColor=#E53935;strokeWidth=2;fontSize=10;fontColor=#E53935;dashed=1;" parent="1" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="422" y="280" as="sourcePoint"/>
                        <mxPoint x="158" y="280" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="EV3" value="[!] RC Link 暂停发送" style="text;html=1;fontSize=10;fontColor=#1976D2;fontStyle=2;align=center;" parent="1" vertex="1">
                    <mxGeometry x="60" y="295" width="170" height="18" as="geometry"/>
                </mxCell>
                <mxCell id="EV4" value="Buffer &lt; 低水位, 解除" style="text;html=1;fontSize=10;fontColor=#4CAF50;fontStyle=2;align=center;" parent="1" vertex="1">
                    <mxGeometry x="620" y="340" width="170" height="18" as="geometry"/>
                </mxCell>
                <mxCell id="R1" value="RESUME / 超时" style="endArrow=block;strokeColor=#4CAF50;strokeWidth=1;fontSize=10;fontColor=#4CAF50;dashed=1;" parent="1" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="692" y="370" as="sourcePoint"/>
                        <mxPoint x="428" y="370" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="R2" value="RESUME" style="endArrow=block;strokeColor=#4CAF50;strokeWidth=1;fontSize=10;fontColor=#4CAF50;dashed=1;" parent="1" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="422" y="400" as="sourcePoint"/>
                        <mxPoint x="158" y="400" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="D3" value="Data (恢复)" style="endArrow=block;strokeColor=#1976D2;fontSize=10;fontColor=#1976D2;" parent="1" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="158" y="440" as="sourcePoint"/>
                        <mxPoint x="422" y="440" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="NT" value="&lt;i&gt;PFC 逐跳传播背压&lt;br&gt;每跳延迟 ~1 RTT&lt;br&gt;风险: PFC 死锁 / PFC 风暴&lt;/i&gt;" style="text;html=1;fontSize=10;fontColor=#999;align=left;" parent="1" vertex="1">
                    <mxGeometry x="30" y="350" width="120" height="50" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
    <diagram name="3.5 ECN Flow" id="sw3">
        <mxGraphModel dx="573" dy="518" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="900" pageHeight="500" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="title" value="&lt;b&gt;3.5 ECN 拥塞通知流程 (仅 Standard 格式)&lt;/b&gt;" style="text;html=1;align=center;fontSize=15;fontColor=#333;" parent="1" vertex="1">
                    <mxGeometry x="150" y="10" width="500" height="28" as="geometry"/>
                </mxCell>
                <mxCell id="LA" value="&lt;b&gt;Chip A (发送端)&lt;/b&gt;&lt;br&gt;RC Link" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E3F2FD;strokeColor=#1976D2;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="80" y="50" width="150" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="LS" value="&lt;b&gt;L2 Switch&lt;/b&gt;&lt;br&gt;出口队列" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF3E0;strokeColor=#F57C00;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="350" y="50" width="150" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="LB" value="&lt;b&gt;Chip B (接收端)&lt;/b&gt;&lt;br&gt;RC Link" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#4CAF50;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="620" y="50" width="150" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="LLA" value="" style="rounded=0;fillColor=#E3F2FD;strokeColor=#1976D2;" parent="1" vertex="1">
                    <mxGeometry x="152" y="90" width="6" height="350" as="geometry"/>
                </mxCell>
                <mxCell id="LLS" value="" style="rounded=0;fillColor=#FFF3E0;strokeColor=#F57C00;" parent="1" vertex="1">
                    <mxGeometry x="422" y="90" width="6" height="350" as="geometry"/>
                </mxCell>
                <mxCell id="LLB" value="" style="rounded=0;fillColor=#E8F5E9;strokeColor=#4CAF50;" parent="1" vertex="1">
                    <mxGeometry x="692" y="90" width="6" height="350" as="geometry"/>
                </mxCell>
                <mxCell id="D1" value="Data (ECN=01, ECT)" style="endArrow=block;strokeColor=#1976D2;fontSize=10;fontColor=#1976D2;" parent="1" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="158" y="130" as="sourcePoint"/>
                        <mxPoint x="422" y="130" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="EV1" value="[!] 队列深度 &gt; 阈值&lt;br&gt;标记 ECN = 11 (CE)" style="text;html=1;fontSize=10;fontColor=#E53935;fontStyle=3;align=center;" parent="1" vertex="1">
                    <mxGeometry x="340" y="145" width="170" height="28" as="geometry"/>
                </mxCell>
                <mxCell id="D2" value="Data (ECN=11, CE)" style="endArrow=block;strokeColor=#E53935;strokeWidth=2;fontSize=10;fontColor=#E53935;" parent="1" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="428" y="195" as="sourcePoint"/>
                        <mxPoint x="692" y="195" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="EV2" value="[!] 检测 ECN=11 (CE)&lt;br&gt;生成 CNP 报文" style="text;html=1;fontSize=10;fontColor=#4CAF50;fontStyle=2;align=center;" parent="1" vertex="1">
                    <mxGeometry x="620" y="210" width="170" height="28" as="geometry"/>
                </mxCell>
                <mxCell id="CNP1" value="CNP (Opcode=10)" style="endArrow=block;strokeColor=#7B1FA2;strokeWidth=2;fontSize=10;fontColor=#7B1FA2;dashed=1;" parent="1" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="692" y="260" as="sourcePoint"/>
                        <mxPoint x="428" y="260" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="CNP2" value="CNP (转发)" style="endArrow=block;strokeColor=#7B1FA2;strokeWidth=2;fontSize=10;fontColor=#7B1FA2;dashed=1;" parent="1" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="422" y="290" as="sourcePoint"/>
                        <mxPoint x="158" y="290" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="EV3" value="[!] Per-QP 速率控制降速&lt;br&gt;(非标准 DCQCN)" style="text;html=1;fontSize=10;fontColor=#1976D2;fontStyle=2;align=center;" parent="1" vertex="1">
                    <mxGeometry x="50" y="305" width="180" height="28" as="geometry"/>
                </mxCell>
                <mxCell id="D3" value="Data (降速后)" style="endArrow=block;strokeColor=#1976D2;fontSize=10;fontColor=#999;" parent="1" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="158" y="360" as="sourcePoint"/>
                        <mxPoint x="422" y="360" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="THR" value="&lt;b&gt;ECN 阈值关系:&lt;/b&gt;&lt;br&gt;ecn_low (30-50%) &lt; ecn_high (70-80%)&lt;br&gt;&lt; pfc_xon (80-85%)&lt;br&gt;&lt;i&gt;ECN 应在 PFC 之前生效&lt;/i&gt;" style="text;html=1;fontSize=10;fontColor=#999;align=left;fillColor=#FAFAFA;rounded=1;strokeColor=#EEE;" parent="1" vertex="1">
                    <mxGeometry x="30" y="400" width="250" height="55" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
    <diagram name="5.3 VOQ + QoS Mapping" id="sw4">
        <mxGraphModel dx="573" dy="518" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1000" pageHeight="650" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="title" value="&lt;b&gt;5.3 VOQ 架构 + PAXI 流量 QoS 映射&lt;/b&gt;" style="text;html=1;align=center;fontSize=15;fontColor=#333;" parent="1" vertex="1">
                    <mxGeometry x="200" y="10" width="500" height="28" as="geometry"/>
                </mxCell>
                <mxCell id="PKT" value="&lt;b&gt;PAXI 报文&lt;/b&gt;&lt;br&gt;到达交换机" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="60" y="60" width="150" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="DV" value="有 VLAN?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#FFE0B2;strokeColor=#F57C00;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="85" y="130" width="100" height="70" as="geometry"/>
                </mxCell>
                <mxCell id="PCP" value="提取 VLAN PCP&lt;br&gt;PCP[2:0] -&gt; 优先级" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#4CAF50;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="230" y="120" width="150" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="DEF" value="使用端口默认优先级&lt;br&gt;(所有帧同一队列)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFEBEE;strokeColor=#E53935;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="230" y="175" width="150" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="VOQ_NODE" value="&lt;b&gt;VOQ[in][out][pri]&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#BBDEFB;strokeColor=#1976D2;fontSize=12;shadow=1;" parent="1" vertex="1">
                    <mxGeometry x="440" y="140" width="160" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="qe1" style="strokeColor=#666;" parent="1" source="PKT" target="DV" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="qe2" value="是" style="strokeColor=#4CAF50;fontColor=#4CAF50;fontSize=10;" parent="1" source="DV" target="PCP" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="qe3" value="否 (AFH_Lite)" style="strokeColor=#E53935;fontColor=#E53935;fontSize=10;exitX=0.5;exitY=1;" parent="1" source="DV" target="DEF" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="qe4" style="strokeColor=#1976D2;" parent="1" source="PCP" target="VOQ_NODE" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="qe5" style="strokeColor=#1976D2;" parent="1" source="DEF" target="VOQ_NODE" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="TBL_L" value="&lt;b&gt;建议的 PAXI 优先级分配&lt;/b&gt;" style="text;html=1;fontSize=12;fontColor=#333;" parent="1" vertex="1">
                    <mxGeometry x="60" y="250" width="250" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="PRI3" value="&lt;b&gt;Pri 3 (高)&lt;/b&gt;&lt;br&gt;TYPE1 ACK + CNP&lt;br&gt;&lt;i&gt;控制帧优先, 保证时效&lt;/i&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFCDD2;strokeColor=#E53935;fontSize=10;align=left;spacingLeft=8;" parent="1" vertex="1">
                    <mxGeometry x="60" y="280" width="200" height="55" as="geometry"/>
                </mxCell>
                <mxCell id="PRI2" value="&lt;b&gt;Pri 2 (中)&lt;/b&gt;&lt;br&gt;TYPE1 REQ (数据请求)&lt;br&gt;&lt;i&gt;主要数据流量&lt;/i&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFE0B2;strokeColor=#F57C00;fontSize=10;align=left;spacingLeft=8;" parent="1" vertex="1">
                    <mxGeometry x="60" y="345" width="200" height="55" as="geometry"/>
                </mxCell>
                <mxCell id="PRI1" value="&lt;b&gt;Pri 1 (低)&lt;/b&gt;&lt;br&gt;TYPE1 RSP (数据响应)&lt;br&gt;&lt;i&gt;独立隔离防 REQ-RSP 死锁&lt;/i&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF8E1;strokeColor=#d6b656;fontSize=10;align=left;spacingLeft=8;" parent="1" vertex="1">
                    <mxGeometry x="60" y="410" width="200" height="55" as="geometry"/>
                </mxCell>
                <mxCell id="PRI0" value="&lt;b&gt;Pri 0 (BE)&lt;/b&gt;&lt;br&gt;TYPE2 / TYPE3&lt;br&gt;&lt;i&gt;多播和管理流量&lt;/i&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#4CAF50;fontSize=10;align=left;spacingLeft=8;" parent="1" vertex="1">
                    <mxGeometry x="60" y="475" width="200" height="55" as="geometry"/>
                </mxCell>
                <mxCell id="VOQ_L" value="&lt;b&gt;VOQ 结构示意 (per 入口端口)&lt;/b&gt;" style="text;html=1;fontSize=12;fontColor=#333;" parent="1" vertex="1">
                    <mxGeometry x="380" y="250" width="300" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="VQ1" value="VOQ[i][0][pri3]" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFCDD2;strokeColor=#E53935;fontSize=9;" parent="1" vertex="1">
                    <mxGeometry x="380" y="280" width="120" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="VQ2" value="VOQ[i][0][pri2]" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFE0B2;strokeColor=#F57C00;fontSize=9;" parent="1" vertex="1">
                    <mxGeometry x="380" y="302" width="120" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="VQ3" value="VOQ[i][0][pri1]" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFF8E1;strokeColor=#d6b656;fontSize=9;" parent="1" vertex="1">
                    <mxGeometry x="380" y="324" width="120" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="VQ4" value="VOQ[i][0][pri0]" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#4CAF50;fontSize=9;" parent="1" vertex="1">
                    <mxGeometry x="380" y="346" width="120" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="VQ_OUT0" value="-&gt; 出口 0" style="text;html=1;fontSize=9;fontColor=#999;" parent="1" vertex="1">
                    <mxGeometry x="510" y="310" width="60" height="18" as="geometry"/>
                </mxCell>
                <mxCell id="VQ5" value="VOQ[i][1][pri3]" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFCDD2;strokeColor=#E53935;fontSize=9;" parent="1" vertex="1">
                    <mxGeometry x="380" y="390" width="120" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="VQ6" value="VOQ[i][1][pri2]" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFE0B2;strokeColor=#F57C00;fontSize=9;" parent="1" vertex="1">
                    <mxGeometry x="380" y="412" width="120" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="VQ7" value="VOQ[i][1][pri1]" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFF8E1;strokeColor=#d6b656;fontSize=9;" parent="1" vertex="1">
                    <mxGeometry x="380" y="434" width="120" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="VQ8" value="VOQ[i][1][pri0]" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#4CAF50;fontSize=9;" parent="1" vertex="1">
                    <mxGeometry x="380" y="456" width="120" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="VQ_OUT1" value="-&gt; 出口 1" style="text;html=1;fontSize=9;fontColor=#999;" parent="1" vertex="1">
                    <mxGeometry x="510" y="420" width="60" height="18" as="geometry"/>
                </mxCell>
                <mxCell id="VQ_DOTS" value="..." style="text;html=1;fontSize=14;fontColor=#999;align=center;" parent="1" vertex="1">
                    <mxGeometry x="410" y="485" width="60" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="SCALE" value="&lt;i&gt;总 VOQ 数 = N_in x N_out x N_pri&lt;br&gt;8 端口 x 8 端口 x 4 优先级 = 256&lt;br&gt;32 端口 x 32 端口 x 8 优先级 = 8192&lt;/i&gt;" style="text;html=1;fontSize=10;fontColor=#999;align=left;" parent="1" vertex="1">
                    <mxGeometry x="600" y="310" width="250" height="50" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
    <diagram name="5.5 Buffer + DT" id="sw5">
        <mxGraphModel dx="573" dy="518" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1000" pageHeight="550" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="title" value="&lt;b&gt;5.5 共享缓冲池 + DT (Dynamic Threshold) 算法&lt;/b&gt;" style="text;html=1;align=center;fontSize=15;fontColor=#333;" parent="1" vertex="1">
                    <mxGeometry x="200" y="10" width="600" height="28" as="geometry"/>
                </mxCell>
                <mxCell id="POOL" value="&lt;b&gt;Shared Memory Pool&lt;/b&gt;&lt;br&gt;(Total: B bytes, 典型 16~64 MB)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#BBDEFB;strokeColor=#1976D2;fontSize=12;shadow=1;" parent="1" vertex="1">
                    <mxGeometry x="300" y="55" width="300" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="ALLOC" value="&lt;b&gt;Dynamic Allocation&lt;/b&gt;&lt;br&gt;DT 算法" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E3F2FD;strokeColor=#1976D2;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="370" y="130" width="160" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="pe1" style="strokeColor=#1976D2;strokeWidth=2;" parent="1" source="POOL" target="ALLOC" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="V1" value="VOQ[0][0]" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E0F7FA;strokeColor=#00ACC1;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="170" y="200" width="90" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="V2" value="VOQ[0][1]" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E0F7FA;strokeColor=#00ACC1;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="280" y="200" width="90" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="V3" value="..." style="text;html=1;fontSize=12;fontColor=#999;align=center;" parent="1" vertex="1">
                    <mxGeometry x="400" y="200" width="40" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="V4" value="VOQ[N][N]" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E0F7FA;strokeColor=#00ACC1;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="460" y="200" width="90" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="ve1" style="strokeColor=#1976D2;" parent="1" source="ALLOC" target="V1" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="ve2" style="strokeColor=#1976D2;" parent="1" source="ALLOC" target="V2" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="ve3" style="strokeColor=#1976D2;" parent="1" source="ALLOC" target="V4" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="DT_BG" value="" style="rounded=1;fillColor=#FFF8E1;strokeColor=#d6b656;dashed=1;" parent="1" vertex="1">
                    <mxGeometry x="30" y="260" width="940" height="220" as="geometry"/>
                </mxCell>
                <mxCell id="DT_L" value="&lt;b&gt;DT 算法入队判断&lt;/b&gt;" style="text;html=1;fontSize=12;fontColor=#B8860B;" parent="1" vertex="1">
                    <mxGeometry x="45" y="265" width="200" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="F1" value="&lt;b&gt;Static_Reserved&lt;/b&gt; = S&lt;br&gt;(保底缓冲, 如 128 KB/VOQ)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="50" y="300" width="200" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="F2" value="&lt;b&gt;Shared_Available&lt;/b&gt;&lt;br&gt;= B - sum(all_used)&lt;br&gt;(全局剩余共享缓冲)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="280" y="295" width="180" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="F3" value="&lt;b&gt;Dynamic_Quota&lt;/b&gt;&lt;br&gt;= alpha x Shared_Available" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFE0B2;strokeColor=#F57C00;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="490" y="300" width="180" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="F4" value="&lt;b&gt;Max_Allowed&lt;/b&gt;&lt;br&gt;= Static_Reserved + Dynamic_Quota" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#4CAF50;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="700" y="300" width="200" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="fe1" style="strokeColor=#666;endArrow=block;endSize=6;" parent="1" source="F1" target="F4" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="fe2" style="strokeColor=#666;endArrow=block;endSize=6;" parent="1" source="F2" target="F3" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="fe3" style="strokeColor=#666;endArrow=block;endSize=6;" parent="1" source="F3" target="F4" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="DEC" value="VOQ.used &lt;&lt;br&gt;&lt;b&gt;Max_Allowed?&lt;/b&gt;" style="rhombus;whiteSpace=wrap;html=1;fillColor=#FFE0B2;strokeColor=#F57C00;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="350" y="380" width="130" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="ALLOW" value="&lt;b&gt;允许入队&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#4CAF50;fontSize=12;" parent="1" vertex="1">
                    <mxGeometry x="180" y="400" width="110" height="36" as="geometry"/>
                </mxCell>
                <mxCell id="DROP" value="&lt;b&gt;Tail Drop&lt;/b&gt;&lt;br&gt;或触发 PFC" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFCDD2;strokeColor=#E53935;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="550" y="395" width="120" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="de1" style="strokeColor=#666;" parent="1" source="F4" target="DEC" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="de2" value="是" style="strokeColor=#4CAF50;fontColor=#4CAF50;fontSize=10;exitX=0;exitY=0.5;" parent="1" source="DEC" target="ALLOW" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="de3" value="否" style="strokeColor=#E53935;fontColor=#E53935;fontSize=10;exitX=1;exitY=0.5;" parent="1" source="DEC" target="DROP" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="ALPHA" value="&lt;b&gt;alpha 参数:&lt;/b&gt;&lt;br&gt;  &lt;1: 保守 (限制单 VOQ)&lt;br&gt;  =1: 均衡 (默认推荐)&lt;br&gt;  =2: 激进 (Incast 吸收)&lt;br&gt;  4~8: 深吸收 (AllReduce)" style="text;html=1;fontSize=10;fontColor=#555;align=left;fillColor=#FAFAFA;rounded=1;strokeColor=#EEE;" parent="1" vertex="1">
                    <mxGeometry x="740" y="370" width="200" height="80" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
    <diagram name="5.6 Egress Scheduling" id="sw6">
        <mxGraphModel dx="573" dy="518" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="800" pageHeight="450" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="title" value="&lt;b&gt;5.6 出口 QoS 调度 (SP + WRR 混合)&lt;/b&gt;" style="text;html=1;align=center;fontSize=15;fontColor=#333;" parent="1" vertex="1">
                    <mxGeometry x="150" y="10" width="500" height="28" as="geometry"/>
                </mxCell>
                <mxCell id="OUT" value="&lt;b&gt;出口端口调度&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E0F7FA;strokeColor=#00ACC1;fontSize=13;shadow=1;" parent="1" vertex="1">
                    <mxGeometry x="280" y="55" width="200" height="44" as="geometry"/>
                </mxCell>
                <mxCell id="SP_BG" value="" style="rounded=1;fillColor=#FFEBEE;strokeColor=#E53935;dashed=1;" parent="1" vertex="1">
                    <mxGeometry x="30" y="130" width="330" height="100" as="geometry"/>
                </mxCell>
                <mxCell id="SP_L" value="&lt;b&gt;SP 层: 严格优先级&lt;/b&gt;" style="text;html=1;fontSize=11;fontColor=#C62828;" parent="1" vertex="1">
                    <mxGeometry x="45" y="133" width="180" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="P3" value="&lt;b&gt;Pri 3: ACK + CNP&lt;/b&gt;&lt;br&gt;(绝对优先, 帧小 &lt;54B)&lt;br&gt;流量占比 &lt;5%" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFCDD2;strokeColor=#E53935;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="55" y="160" width="280" height="55" as="geometry"/>
                </mxCell>
                <mxCell id="WRR_BG" value="" style="rounded=1;fillColor=#FFF8E1;strokeColor=#d6b656;dashed=1;" parent="1" vertex="1">
                    <mxGeometry x="30" y="260" width="740" height="130" as="geometry"/>
                </mxCell>
                <mxCell id="WRR_L" value="&lt;b&gt;WRR 层: 加权轮转&lt;/b&gt; (数据流量)" style="text;html=1;fontSize=11;fontColor=#B8860B;" parent="1" vertex="1">
                    <mxGeometry x="45" y="263" width="250" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="P2" value="&lt;b&gt;Pri 2: REQ&lt;/b&gt;&lt;br&gt;(数据请求)&lt;br&gt;&lt;b&gt;权重 50%&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFE0B2;strokeColor=#F57C00;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="55" y="295" width="200" height="55" as="geometry"/>
                </mxCell>
                <mxCell id="P1" value="&lt;b&gt;Pri 1: RSP&lt;/b&gt;&lt;br&gt;(数据响应)&lt;br&gt;&lt;b&gt;权重 40%&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF2CC;strokeColor=#d6b656;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="280" y="295" width="200" height="55" as="geometry"/>
                </mxCell>
                <mxCell id="P0" value="&lt;b&gt;Pri 0: MUL/TYPE3&lt;/b&gt;&lt;br&gt;(多播/管理)&lt;br&gt;&lt;b&gt;权重 10%&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#4CAF50;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="505" y="295" width="200" height="55" as="geometry"/>
                </mxCell>
                <mxCell id="oe1" style="strokeColor=#C62828;strokeWidth=2;" parent="1" source="OUT" target="SP_BG" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="oe2" style="strokeColor=#B8860B;strokeWidth=2;" parent="1" source="OUT" target="WRR_BG" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="REASON" value="&lt;b&gt;设计原因:&lt;/b&gt;&lt;br&gt;- ACK/CNP 用 SP: 帧小, 不饥饿其他队列&lt;br&gt;  但保证控制帧最低延迟&lt;br&gt;- REQ/RSP 用 WRR: 防止 REQ 独占带宽&lt;br&gt;  导致 RSP 返回受阻&lt;br&gt;- RSP 权重略低: 响应通常滞后于请求" style="text;html=1;fontSize=10;fontColor=#555;align=left;fillColor=#FAFAFA;rounded=1;strokeColor=#EEE;" parent="1" vertex="1">
                    <mxGeometry x="420" y="115" width="340" height="110" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
    <diagram name="5.7 PFC Hop-by-Hop" id="sw7">
        <mxGraphModel dx="573" dy="518" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1000" pageHeight="650" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="title" value="&lt;b&gt;5.7 PFC 逐跳传播 (多跳网络)&lt;/b&gt;" style="text;html=1;align=center;fontSize=15;fontColor=#333;" parent="1" vertex="1">
                    <mxGeometry x="200" y="10" width="500" height="28" as="geometry"/>
                </mxCell>
                <mxCell id="LA" value="&lt;b&gt;Chip A&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E3F2FD;strokeColor=#1976D2;fontSize=12;" parent="1" vertex="1">
                    <mxGeometry x="50" y="50" width="100" height="36" as="geometry"/>
                </mxCell>
                <mxCell id="LS1" value="&lt;b&gt;Switch 1&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF3E0;strokeColor=#F57C00;fontSize=12;" parent="1" vertex="1">
                    <mxGeometry x="260" y="50" width="100" height="36" as="geometry"/>
                </mxCell>
                <mxCell id="LS2" value="&lt;b&gt;Switch 2&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF3E0;strokeColor=#F57C00;fontSize=12;" parent="1" vertex="1">
                    <mxGeometry x="470" y="50" width="100" height="36" as="geometry"/>
                </mxCell>
                <mxCell id="LB" value="&lt;b&gt;Chip B&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#4CAF50;fontSize=12;" parent="1" vertex="1">
                    <mxGeometry x="680" y="50" width="100" height="36" as="geometry"/>
                </mxCell>
                <mxCell id="LLA" value="" style="rounded=0;fillColor=#E3F2FD;strokeColor=#1976D2;" parent="1" vertex="1">
                    <mxGeometry x="97" y="86" width="6" height="480" as="geometry"/>
                </mxCell>
                <mxCell id="LLS1" value="" style="rounded=0;fillColor=#FFF3E0;strokeColor=#F57C00;" parent="1" vertex="1">
                    <mxGeometry x="307" y="86" width="6" height="480" as="geometry"/>
                </mxCell>
                <mxCell id="LLS2" value="" style="rounded=0;fillColor=#FFF3E0;strokeColor=#F57C00;" parent="1" vertex="1">
                    <mxGeometry x="517" y="86" width="6" height="480" as="geometry"/>
                </mxCell>
                <mxCell id="LLB" value="" style="rounded=0;fillColor=#E8F5E9;strokeColor=#4CAF50;" parent="1" vertex="1">
                    <mxGeometry x="727" y="86" width="6" height="480" as="geometry"/>
                </mxCell>
                <mxCell id="D1" value="Data (pri p)" style="endArrow=block;strokeColor=#1976D2;fontSize=9;" parent="1" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="103" y="120" as="sourcePoint"/>
                        <mxPoint x="307" y="120" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="D2" value="Data (pri p)" style="endArrow=block;strokeColor=#F57C00;fontSize=9;" parent="1" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="313" y="145" as="sourcePoint"/>
                        <mxPoint x="517" y="145" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="D3" value="Data (pri p)" style="endArrow=block;strokeColor=#F57C00;fontSize=9;" parent="1" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="523" y="170" as="sourcePoint"/>
                        <mxPoint x="727" y="170" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="EV1" value="Step 1: PAXI RX&lt;br&gt;Buffer &gt; 高水位" style="text;html=1;fontSize=9;fontColor=#E53935;fontStyle=3;" parent="1" vertex="1">
                    <mxGeometry x="740" y="195" width="120" height="28" as="geometry"/>
                </mxCell>
                <mxCell id="PFC1" value="PFC PAUSE (pri p)" style="endArrow=block;strokeColor=#E53935;strokeWidth=2;fontSize=9;fontColor=#E53935;dashed=1;" parent="1" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="727" y="240" as="sourcePoint"/>
                        <mxPoint x="523" y="240" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="EV2" value="Step 2: 暂停 pri p 到 B&lt;br&gt;VOQ 积压 &gt; PFC 阈值" style="text;html=1;fontSize=9;fontColor=#F57C00;fontStyle=2;" parent="1" vertex="1">
                    <mxGeometry x="530" y="255" width="140" height="28" as="geometry"/>
                </mxCell>
                <mxCell id="PFC2" value="PFC PAUSE (pri p)" style="endArrow=block;strokeColor=#E53935;strokeWidth=2;fontSize=9;fontColor=#E53935;dashed=1;" parent="1" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="517" y="310" as="sourcePoint"/>
                        <mxPoint x="313" y="310" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="EV3" value="Step 3: 暂停 pri p 到 S2&lt;br&gt;VOQ 积压" style="text;html=1;fontSize=9;fontColor=#F57C00;fontStyle=2;" parent="1" vertex="1">
                    <mxGeometry x="320" y="325" width="140" height="28" as="geometry"/>
                </mxCell>
                <mxCell id="PFC3" value="PFC PAUSE (pri p)" style="endArrow=block;strokeColor=#E53935;strokeWidth=2;fontSize=9;fontColor=#E53935;dashed=1;" parent="1" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="307" y="380" as="sourcePoint"/>
                        <mxPoint x="103" y="380" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="EV4" value="Step 4: RC Link&lt;br&gt;暂停发送 pri p&lt;br&gt;&lt;b&gt;背压逐跳完成&lt;/b&gt;" style="text;html=1;fontSize=9;fontColor=#1976D2;fontStyle=2;" parent="1" vertex="1">
                    <mxGeometry x="10" y="395" width="100" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="RISK_L" value="&lt;b&gt;PFC 风险:&lt;/b&gt;" style="text;html=1;fontSize=11;fontColor=#C62828;" parent="1" vertex="1">
                    <mxGeometry x="50" y="470" width="100" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="RK1" value="&lt;b&gt;PFC 死锁&lt;/b&gt;: 环路拓扑中循环依赖&lt;br&gt;[缓解] 避免环路 / PFC Watchdog" style="text;html=1;fontSize=9;fontColor=#555;align=left;fillColor=#FAFAFA;rounded=1;strokeColor=#EEE;" parent="1" vertex="1">
                    <mxGeometry x="50" y="494" width="250" height="35" as="geometry"/>
                </mxCell>
                <mxCell id="RK2" value="&lt;b&gt;PFC 风暴&lt;/b&gt;: 单点 PAUSE 雪崩传播&lt;br&gt;[缓解] 限制传播深度 / 用 ECN" style="text;html=1;fontSize=9;fontColor=#555;align=left;fillColor=#FAFAFA;rounded=1;strokeColor=#EEE;" parent="1" vertex="1">
                    <mxGeometry x="330" y="494" width="250" height="35" as="geometry"/>
                </mxCell>
                <mxCell id="RK3" value="&lt;b&gt;Victim Flow&lt;/b&gt;: 无关流被同优先级误暂停&lt;br&gt;[缓解] REQ/RSP 分优先级" style="text;html=1;fontSize=9;fontColor=#555;align=left;fillColor=#FAFAFA;rounded=1;strokeColor=#EEE;" parent="1" vertex="1">
                    <mxGeometry x="610" y="494" width="250" height="35" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
    <diagram name="5.8 ECN Thresholds" id="sw8">
        <mxGraphModel dx="573" dy="518" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1000" pageHeight="450" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="title" value="&lt;b&gt;5.8 ECN 标记逻辑 + 阈值关系&lt;/b&gt;" style="text;html=1;align=center;fontSize=15;fontColor=#333;" parent="1" vertex="1">
                    <mxGeometry x="250" y="10" width="500" height="28" as="geometry"/>
                </mxCell>
                <mxCell id="BAR_L" value="&lt;b&gt;出口队列深度&lt;/b&gt;  0% --------------------------------------------------------------------------&gt; 100%" style="text;html=1;fontSize=11;fontColor=#333;" parent="1" vertex="1">
                    <mxGeometry x="30" y="50" width="900" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="Z1" value="&lt;b&gt;正常&lt;/b&gt;&lt;br&gt;不标记" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#4CAF50;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="30" y="80" width="200" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="Z2" value="&lt;b&gt;ECN 概率标记&lt;/b&gt;&lt;br&gt;P = (Q-low)/(high-low)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFF8E1;strokeColor=#d6b656;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="230" y="80" width="200" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="Z3" value="&lt;b&gt;ECN 全标记&lt;/b&gt;&lt;br&gt;ECN = 11 (CE)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFE0B2;strokeColor=#F57C00;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="430" y="80" width="140" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="Z4" value="&lt;b&gt;PFC 触发&lt;/b&gt;&lt;br&gt;PAUSE 帧" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFCDD2;strokeColor=#E53935;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="570" y="80" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="Z5" value="&lt;b&gt;PFC 持续&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#F8BBD0;strokeColor=#C62828;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="690" y="80" width="100" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="Z6" value="&lt;b&gt;溢出!&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E53935;strokeColor=#B71C1C;fontColor=#FFF;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="790" y="80" width="70" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="TH1" value="|&lt;br&gt;ecn_low&lt;br&gt;(30-50%)" style="text;html=1;fontSize=9;fontColor=#B8860B;align=center;" parent="1" vertex="1">
                    <mxGeometry x="205" y="132" width="70" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="TH2" value="|&lt;br&gt;ecn_high&lt;br&gt;(70-80%)" style="text;html=1;fontSize=9;fontColor=#F57C00;align=center;" parent="1" vertex="1">
                    <mxGeometry x="405" y="132" width="70" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="TH3" value="|&lt;br&gt;pfc_xon&lt;br&gt;(80-85%)" style="text;html=1;fontSize=9;fontColor=#E53935;align=center;" parent="1" vertex="1">
                    <mxGeometry x="545" y="132" width="70" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="TH4" value="|&lt;br&gt;pfc_xoff&lt;br&gt;(60-70%)" style="text;html=1;fontSize=9;fontColor=#C62828;align=center;" parent="1" vertex="1">
                    <mxGeometry x="665" y="132" width="70" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="KEY" value="&lt;b&gt;设计目标: ECN 应在 PFC 之前生效, 通过端到端降速避免触发逐跳 PFC&lt;/b&gt;" style="text;html=1;align=center;fontSize=12;fontColor=#E65100;" parent="1" vertex="1">
                    <mxGeometry x="100" y="195" width="700" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="FL" value="&lt;b&gt;ECN 标记逻辑 (帧出队时):&lt;/b&gt;" style="text;html=1;fontSize=12;fontColor=#333;" parent="1" vertex="1">
                    <mxGeometry x="30" y="235" width="250" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="CHK1" value="IP ECN&lt;br&gt;字段?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#FFE0B2;strokeColor=#F57C00;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="60" y="270" width="90" height="70" as="geometry"/>
                </mxCell>
                <mxCell id="SKIP" value="跳过 (不支持)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F5F5F5;strokeColor=#999;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="200" y="258" width="120" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="CHK2" value="队列深度?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#FFE0B2;strokeColor=#F57C00;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="200" y="310" width="90" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="NOMARK" value="不标记" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#4CAF50;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="340" y="290" width="80" height="28" as="geometry"/>
                </mxCell>
                <mxCell id="PROB" value="概率标记&lt;br&gt;ECN=11" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF2CC;strokeColor=#d6b656;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="340" y="325" width="80" height="36" as="geometry"/>
                </mxCell>
                <mxCell id="FULL" value="确定标记&lt;br&gt;ECN=11" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFCDD2;strokeColor=#E53935;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="340" y="370" width="80" height="36" as="geometry"/>
                </mxCell>
                <mxCell id="ce1" value="00 (Not-ECT)" style="strokeColor=#999;fontSize=8;fontColor=#999;" parent="1" source="CHK1" target="SKIP" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="ce2" value="01/10 (ECT)" style="strokeColor=#F57C00;fontSize=8;fontColor=#F57C00;exitX=0.5;exitY=1;" parent="1" source="CHK1" target="CHK2" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="ce3" value="&lt; low" style="strokeColor=#4CAF50;fontSize=8;fontColor=#4CAF50;" parent="1" source="CHK2" target="NOMARK" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="ce4" value="low~high" style="strokeColor=#B8860B;fontSize=8;fontColor=#B8860B;exitX=1;exitY=0.5;" parent="1" source="CHK2" target="PROB" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="ce5" value="&gt;= high" style="strokeColor=#E53935;fontSize=8;fontColor=#E53935;exitX=0.5;exitY=1;" parent="1" source="CHK2" target="FULL" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
    <diagram name="6.x Latency Model" id="sw9">
        <mxGraphModel dx="573" dy="518" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1100" pageHeight="400" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="title" value="&lt;b&gt;6. 交换机延迟模型&lt;/b&gt;  T_total = T_paxi_tx + T_rclink_tx + T_cesoc_tx + T_link1 + &lt;b&gt;T_switch&lt;/b&gt; + T_link2 + T_cesoc_rx + T_rclink_rx + T_paxi_rx" style="text;html=1;align=center;fontSize=12;fontColor=#333;" parent="1" vertex="1">
                    <mxGeometry x="20" y="10" width="1050" height="28" as="geometry"/>
                </mxCell>
                <mxCell id="SW_L" value="&lt;b&gt;T_switch 分解:&lt;/b&gt;" style="text;html=1;fontSize=13;fontColor=#00838F;" parent="1" vertex="1">
                    <mxGeometry x="30" y="50" width="200" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="T1" value="&lt;b&gt;T_ingress&lt;/b&gt;&lt;br&gt;帧解析 + QoS 分类&lt;br&gt;+ MAC 查表&lt;br&gt;&lt;b&gt;50-200 ns&lt;/b&gt; (固定)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E0F7FA;strokeColor=#00ACC1;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="30" y="80" width="180" height="70" as="geometry"/>
                </mxCell>
                <mxCell id="T2" value="&lt;b&gt;T_queueing&lt;/b&gt;&lt;br&gt;VOQ 排队&lt;br&gt;+ iSLIP 调度&lt;br&gt;&lt;b&gt;0 ~ 数 us&lt;/b&gt; (负载相关)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFE0B2;strokeColor=#F57C00;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="240" y="80" width="180" height="70" as="geometry"/>
                </mxCell>
                <mxCell id="T3" value="&lt;b&gt;T_crossbar&lt;/b&gt;&lt;br&gt;Crossbar 穿越&lt;br&gt;&lt;b&gt;10-50 ns&lt;/b&gt; (固定)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF8E1;strokeColor=#d6b656;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="450" y="80" width="150" height="70" as="geometry"/>
                </mxCell>
                <mxCell id="T4" value="&lt;b&gt;T_egress&lt;/b&gt;&lt;br&gt;出口调度 + 串行化&lt;br&gt;&lt;b&gt;帧大小相关&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#4CAF50;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="630" y="80" width="160" height="70" as="geometry"/>
                </mxCell>
                <mxCell id="te1" style="strokeColor=#00838F;strokeWidth=2;endArrow=block;endSize=8;" parent="1" source="T1" target="T2" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="te2" style="strokeColor=#F57C00;strokeWidth=2;endArrow=block;endSize=8;" parent="1" source="T2" target="T3" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="te3" style="strokeColor=#d6b656;strokeWidth=2;endArrow=block;endSize=8;" parent="1" source="T3" target="T4" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="FM_L" value="&lt;b&gt;转发模式:&lt;/b&gt;" style="text;html=1;fontSize=12;fontColor=#333;" parent="1" vertex="1">
                    <mxGeometry x="30" y="175" width="120" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="CT" value="&lt;b&gt;Cut-Through&lt;/b&gt; (推荐)&lt;br&gt;固定 ~300-500 ns (与帧大小无关)&lt;br&gt;入口/出口速率相同时适用" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#4CAF50;fontSize=10;align=left;spacingLeft=8;" parent="1" vertex="1">
                    <mxGeometry x="30" y="200" width="280" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="SF" value="&lt;b&gt;Store-and-Forward&lt;/b&gt;&lt;br&gt;T_serialization + T_processing (帧大小相关)&lt;br&gt;速率不匹配或需 CRC 校验时" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF2CC;strokeColor=#d6b656;fontSize=10;align=left;spacingLeft=8;" parent="1" vertex="1">
                    <mxGeometry x="340" y="200" width="280" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="SER_L" value="&lt;b&gt;PAXI 帧串行化延迟:&lt;/b&gt;" style="text;html=1;fontSize=12;fontColor=#333;" parent="1" vertex="1">
                    <mxGeometry x="30" y="270" width="200" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="S1" value="TYPE1 最大帧 ~1406B" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E0F7FA;strokeColor=#00ACC1;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="30" y="300" width="160" height="28" as="geometry"/>
                </mxCell>
                <mxCell id="S1V" value="100G: 112ns | 200G: 56ns | 400G: 28ns" style="text;html=1;fontSize=9;fontColor=#555;" parent="1" vertex="1">
                    <mxGeometry x="200" y="303" width="250" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="S2" value="TYPE1 ACK ~54B" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E0F7FA;strokeColor=#00ACC1;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="30" y="335" width="160" height="28" as="geometry"/>
                </mxCell>
                <mxCell id="S2V" value="100G: 4.3ns | 200G: 2.2ns | 400G: 1.1ns" style="text;html=1;fontSize=9;fontColor=#555;" parent="1" vertex="1">
                    <mxGeometry x="200" y="338" width="250" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="MH" value="&lt;b&gt;多跳延迟:&lt;/b&gt;&lt;br&gt;T_network = N x (T_prop + T_switch_fixed)&lt;br&gt;+ T_serialization (仅最后一跳)&lt;br&gt;+ sum(T_queueing_i)" style="text;html=1;fontSize=10;fontColor=#555;align=left;fillColor=#FAFAFA;rounded=1;strokeColor=#EEE;" parent="1" vertex="1">
                    <mxGeometry x="650" y="200" width="260" height="70" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
    <diagram name="7. Network Scenarios" id="sw10">
        <mxGraphModel dx="573" dy="518" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1000" pageHeight="700" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="title" value="&lt;b&gt;7. 三种典型组网场景对比&lt;/b&gt;" style="text;html=1;align=center;fontSize=16;fontColor=#333;" parent="1" vertex="1">
                    <mxGeometry x="250" y="10" width="500" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="ABG" value="" style="rounded=1;fillColor=#E3F2FD;strokeColor=#1976D2;strokeWidth=1.5;" parent="1" vertex="1">
                    <mxGeometry x="30" y="55" width="940" height="170" as="geometry"/>
                </mxCell>
                <mxCell id="AL" value="&lt;b&gt;场景 A: 点对点直连 (无交换机)&lt;/b&gt;" style="text;html=1;fontSize=13;fontColor=#1976D2;" parent="1" vertex="1">
                    <mxGeometry x="45" y="60" width="300" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="A1" value="&lt;b&gt;Chip A&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#BBDEFB;strokeColor=#1976D2;fontSize=12;shadow=1;" parent="1" vertex="1">
                    <mxGeometry x="120" y="95" width="120" height="44" as="geometry"/>
                </mxCell>
                <mxCell id="A2" value="&lt;b&gt;Chip B&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#BBDEFB;strokeColor=#1976D2;fontSize=12;shadow=1;" parent="1" vertex="1">
                    <mxGeometry x="400" y="95" width="120" height="44" as="geometry"/>
                </mxCell>
                <mxCell id="AL1" value="200G/400G Link" style="strokeWidth=3;strokeColor=#1976D2;fontSize=10;fontColor=#1976D2;" parent="1" source="A1" target="A2" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="AINFO" value="&lt;b&gt;流控:&lt;/b&gt; CBFC (推荐) 或 PFC&lt;br&gt;&lt;b&gt;格式:&lt;/b&gt; AFH_GEN1/GEN2 (低头开销)&lt;br&gt;&lt;b&gt;重传:&lt;/b&gt; Go-Back-N (TYPE1)&lt;br&gt;&lt;b&gt;延迟:&lt;/b&gt; T_switch = 0, 最低延迟" style="text;html=1;fontSize=10;fontColor=#333;align=left;fillColor=#E3F2FD;rounded=1;strokeColor=#BBDEFB;" parent="1" vertex="1">
                    <mxGeometry x="600" y="80" width="340" height="70" as="geometry"/>
                </mxCell>
                <mxCell id="BBG" value="" style="rounded=1;fillColor=#FFF3E0;strokeColor=#F57C00;strokeWidth=1.5;" parent="1" vertex="1">
                    <mxGeometry x="30" y="245" width="940" height="180" as="geometry"/>
                </mxCell>
                <mxCell id="BL" value="&lt;b&gt;场景 B: 交换机组网 LITE 模式 (最高带宽效率)&lt;/b&gt;" style="text;html=1;fontSize=13;fontColor=#E65100;" parent="1" vertex="1">
                    <mxGeometry x="45" y="250" width="400" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="B1" value="&lt;b&gt;Chip A&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFE0B2;strokeColor=#F57C00;fontSize=12;shadow=1;" parent="1" vertex="1">
                    <mxGeometry x="60" y="290" width="100" height="44" as="geometry"/>
                </mxCell>
                <mxCell id="BS1" value="&lt;b&gt;Switch 1&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF8E1;strokeColor=#F57C00;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="230" y="290" width="100" height="44" as="geometry"/>
                </mxCell>
                <mxCell id="BS2" value="&lt;b&gt;Switch 2&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF8E1;strokeColor=#F57C00;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="400" y="290" width="100" height="44" as="geometry"/>
                </mxCell>
                <mxCell id="B2" value="&lt;b&gt;Chip B&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFE0B2;strokeColor=#F57C00;fontSize=12;shadow=1;" parent="1" vertex="1">
                    <mxGeometry x="570" y="290" width="100" height="44" as="geometry"/>
                </mxCell>
                <mxCell id="be1" style="strokeWidth=2;strokeColor=#F57C00;" parent="1" source="B1" target="BS1" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="be2" style="strokeWidth=2;strokeColor=#F57C00;" parent="1" source="BS1" target="BS2" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="be3" style="strokeWidth=2;strokeColor=#F57C00;" parent="1" source="BS2" target="B2" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="BINFO" value="&lt;b&gt;流控:&lt;/b&gt; PFC (交换机参与) 或 CBFC (透明穿越)&lt;br&gt;&lt;b&gt;格式:&lt;/b&gt; AFH_Lite (头部仅 12B, 效率 98.8%)&lt;br&gt;&lt;b&gt;重传:&lt;/b&gt; [FAIL] 无 (Go-Back-N 关闭)&lt;br&gt;&lt;b&gt;关键:&lt;/b&gt; 丢包不可恢复, 交换机必须无损" style="text;html=1;fontSize=10;fontColor=#333;align=left;fillColor=#FFF3E0;rounded=1;strokeColor=#FFE0B2;" parent="1" vertex="1">
                    <mxGeometry x="700" y="275" width="250" height="75" as="geometry"/>
                </mxCell>
                <mxCell id="BWARN" value="[!] 丢包 = 数据丢失" style="text;html=1;fontSize=10;fontColor=#E53935;fontStyle=1;" parent="1" vertex="1">
                    <mxGeometry x="200" y="345" width="200" height="18" as="geometry"/>
                </mxCell>
                <mxCell id="CBG" value="" style="rounded=1;fillColor=#E8F5E9;strokeColor=#4CAF50;strokeWidth=1.5;" parent="1" vertex="1">
                    <mxGeometry x="30" y="445" width="940" height="200" as="geometry"/>
                </mxCell>
                <mxCell id="CL" value="&lt;b&gt;场景 C: 交换机组网 Standard 格式 (全功能, 最接近 RoCE v2)&lt;/b&gt;" style="text;html=1;fontSize=13;fontColor=#2E7D32;" parent="1" vertex="1">
                    <mxGeometry x="45" y="450" width="500" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="C1" value="&lt;b&gt;Chip A&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#C8E6C9;strokeColor=#4CAF50;fontSize=12;shadow=1;" parent="1" vertex="1">
                    <mxGeometry x="60" y="490" width="100" height="44" as="geometry"/>
                </mxCell>
                <mxCell id="CS1" value="&lt;b&gt;Switch 1&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#4CAF50;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="230" y="490" width="100" height="44" as="geometry"/>
                </mxCell>
                <mxCell id="CS2" value="&lt;b&gt;Switch 2&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#4CAF50;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="400" y="490" width="100" height="44" as="geometry"/>
                </mxCell>
                <mxCell id="C2" value="&lt;b&gt;Chip B&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#C8E6C9;strokeColor=#4CAF50;fontSize=12;shadow=1;" parent="1" vertex="1">
                    <mxGeometry x="570" y="490" width="100" height="44" as="geometry"/>
                </mxCell>
                <mxCell id="ce1" style="strokeWidth=2;strokeColor=#4CAF50;" parent="1" source="C1" target="CS1" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="ce2" style="strokeWidth=2;strokeColor=#4CAF50;" parent="1" source="CS1" target="CS2" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="ce3" style="strokeWidth=2;strokeColor=#4CAF50;" parent="1" source="CS2" target="C2" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="CINFO" value="&lt;b&gt;流控:&lt;/b&gt; PFC (逐跳背压) + ECN (端到端拥塞通知)&lt;br&gt;&lt;b&gt;格式:&lt;/b&gt; Standard (含 IP/UDP, 头部 50-54B, 效率 95.6%)&lt;br&gt;&lt;b&gt;重传:&lt;/b&gt; [OK] Go-Back-N (TYPE1, E2E 保护)&lt;br&gt;&lt;b&gt;优势:&lt;/b&gt; ECN 主动避塞 + PFC 最后防线 + 端到端重传" style="text;html=1;fontSize=10;fontColor=#333;align=left;fillColor=#E8F5E9;rounded=1;strokeColor=#C8E6C9;" parent="1" vertex="1">
                    <mxGeometry x="700" y="475" width="250" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="CF1" value="ECN" style="text;html=1;fontSize=9;fontColor=#4CAF50;fontStyle=1;align=center;" parent="1" vertex="1">
                    <mxGeometry x="265" y="540" width="40" height="16" as="geometry"/>
                </mxCell>
                <mxCell id="CF2" value="PFC" style="text;html=1;fontSize=9;fontColor=#E53935;fontStyle=1;align=center;" parent="1" vertex="1">
                    <mxGeometry x="355" y="540" width="40" height="16" as="geometry"/>
                </mxCell>
                <mxCell id="CF3" value="Go-Back-N" style="text;html=1;fontSize=9;fontColor=#1976D2;fontStyle=1;align=center;" parent="1" vertex="1">
                    <mxGeometry x="430" y="540" width="70" height="16" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
</mxfile>