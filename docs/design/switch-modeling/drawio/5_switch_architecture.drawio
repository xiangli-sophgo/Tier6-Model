<mxfile host="draw.io" modified="2026-02-15T00:00:00.000Z" agent="Claude" version="24.0.0" type="device">
  <diagram id="pipeline" name="5.1 Switch Pipeline">
    <mxGraphModel dx="1100" dy="620" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1100" pageHeight="620" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- Title -->
        <mxCell id="t1_title" value="5.1 Switch Pipeline - L2 交换机 6 级流水线" style="text;html=1;align=center;fontSize=16;fontColor=#333;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="220" y="10" width="400" height="30" as="geometry"/>
        </mxCell>

        <!-- ==================== Ingress Region ==================== -->
        <mxCell id="t1_ingress_region" value="&lt;b style=&quot;color:#2885ca;font-size:13px;&quot;&gt;Ingress 入口处理&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d6e9f8;fillOpacity=15;strokeColor=#2885ca;dashed=1;dashPattern=8 4;verticalAlign=top;spacingTop=4;align=left;spacingLeft=10;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="30" y="50" width="470" height="260" as="geometry"/>
        </mxCell>

        <!-- PHY RX -->
        <mxCell id="t1_phy_rx" value="&lt;b&gt;PHY RX&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#666&quot; style=&quot;font-size:10px;&quot;&gt;SerDes 接收&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d6e9f8;strokeColor=#2885ca;fontSize=12;shadow=1;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="60" y="90" width="140" height="44" as="geometry"/>
        </mxCell>

        <!-- Stage 1 -->
        <mxCell id="t1_s1" value="&lt;b&gt;Stage 1: 帧解析&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#666&quot; style=&quot;font-size:10px;&quot;&gt;提取 MAC DA/SA, 识别 EtherType/VLAN&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d6e9f8;strokeColor=#2885ca;fontSize=12;shadow=1;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="230" y="90" width="170" height="50" as="geometry"/>
        </mxCell>

        <!-- Stage 2 -->
        <mxCell id="t1_s2" value="&lt;b&gt;Stage 2: QoS 分类&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#666&quot; style=&quot;font-size:10px;&quot;&gt;VLAN PCP / DSCP / 端口默认&lt;br&gt;-&amp;gt; 优先级队列映射&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d6e9f8;strokeColor=#2885ca;fontSize=12;shadow=1;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="60" y="170" width="180" height="50" as="geometry"/>
        </mxCell>

        <!-- Stage 3 -->
        <mxCell id="t1_s3" value="&lt;b&gt;Stage 3: MAC 查表&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#666&quot; style=&quot;font-size:10px;&quot;&gt;MAC DA -&amp;gt; 出口端口&lt;br&gt;(无需解析 PAXI/RH)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d6e9f8;strokeColor=#2885ca;fontSize=12;shadow=1;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="260" y="170" width="170" height="50" as="geometry"/>
        </mxCell>

        <!-- VOQ -->
        <mxCell id="t1_voq" value="&lt;b&gt;VOQ 入队&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#666&quot; style=&quot;font-size:10px;&quot;&gt;VOQ[in][out][pri], DT 算法检查&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d6e9f8;strokeColor=#2885ca;fontSize=12;shadow=1;fontColor=#333;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="160" y="250" width="170" height="50" as="geometry"/>
        </mxCell>

        <!-- Ingress Arrows -->
        <mxCell id="t1_e_phy_s1" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;rounded=0;html=1;strokeWidth=2;endArrow=block;endFill=1;strokeColor=#2885ca;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" source="t1_phy_rx" target="t1_s1" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="t1_e_s1_s2" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;rounded=0;html=1;strokeWidth=2;endArrow=block;endFill=1;strokeColor=#2885ca;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" source="t1_s1" target="t1_s2" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="t1_e_s1_s3" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;rounded=0;html=1;strokeWidth=2;endArrow=block;endFill=1;strokeColor=#2885ca;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" source="t1_s1" target="t1_s3" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="t1_e_s2_voq" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;rounded=0;html=1;strokeWidth=2;endArrow=block;endFill=1;strokeColor=#2885ca;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.25;entryY=0;entryDx=0;entryDy=0;" edge="1" source="t1_s2" target="t1_voq" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="t1_e_s3_voq" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;rounded=0;html=1;strokeWidth=2;endArrow=block;endFill=1;strokeColor=#2885ca;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.75;entryY=0;entryDx=0;entryDy=0;" edge="1" source="t1_s3" target="t1_voq" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- ==================== Crossbar Region ==================== -->
        <mxCell id="t1_crossbar_region" value="&lt;b style=&quot;color:#e8a838;font-size:13px;&quot;&gt;Crossbar 交叉矩阵&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fef3e0;fillOpacity=15;strokeColor=#e8a838;dashed=1;dashPattern=8 4;verticalAlign=top;spacingTop=4;align=left;spacingLeft=10;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="30" y="320" width="470" height="100" as="geometry"/>
        </mxCell>

        <!-- Stage 4 -->
        <mxCell id="t1_s4" value="&lt;b&gt;Stage 4: iSLIP 调度&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#666&quot; style=&quot;font-size:10px;&quot;&gt;Request -&amp;gt; Grant -&amp;gt; Accept&lt;br&gt;1~4 迭代/时间槽&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fef3e0;strokeColor=#e8a838;fontSize=12;shadow=1;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="60" y="355" width="200" height="50" as="geometry"/>
        </mxCell>

        <!-- Stage 5 -->
        <mxCell id="t1_s5" value="&lt;b&gt;Stage 5: Crossbar 穿越&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#666&quot; style=&quot;font-size:10px;&quot;&gt;10~50 ns&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fef3e0;strokeColor=#e8a838;fontSize=12;shadow=1;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="300" y="355" width="190" height="50" as="geometry"/>
        </mxCell>

        <!-- Crossbar Arrows -->
        <mxCell id="t1_e_voq_s4" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;rounded=0;html=1;strokeWidth=2;endArrow=block;endFill=1;strokeColor=#2885ca;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" source="t1_voq" target="t1_s4" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="t1_e_s4_s5" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;rounded=0;html=1;strokeWidth=2;endArrow=block;endFill=1;strokeColor=#e8a838;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" source="t1_s4" target="t1_s5" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- ==================== Egress Region ==================== -->
        <mxCell id="t1_egress_region" value="&lt;b style=&quot;color:#43a047;font-size:13px;&quot;&gt;Egress 出口处理&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e2f0e2;fillOpacity=15;strokeColor=#43a047;dashed=1;dashPattern=8 4;verticalAlign=top;spacingTop=4;align=left;spacingLeft=10;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="30" y="430" width="470" height="100" as="geometry"/>
        </mxCell>

        <!-- Stage 6 -->
        <mxCell id="t1_s6" value="&lt;b&gt;Stage 6: 出口调度&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#666&quot; style=&quot;font-size:10px;&quot;&gt;SP + WRR 混合调度&lt;br&gt;ECN 标记 (仅 Standard)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e2f0e2;strokeColor=#43a047;fontSize=12;shadow=1;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="60" y="465" width="200" height="50" as="geometry"/>
        </mxCell>

        <!-- PHY TX -->
        <mxCell id="t1_phy_tx" value="&lt;b&gt;PHY TX&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#666&quot; style=&quot;font-size:10px;&quot;&gt;SerDes 发送&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d6e9f8;strokeColor=#2885ca;fontSize=12;shadow=1;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="310" y="470" width="140" height="44" as="geometry"/>
        </mxCell>

        <!-- Egress Arrows -->
        <mxCell id="t1_e_s5_s6" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;rounded=0;html=1;strokeWidth=2;endArrow=block;endFill=1;strokeColor=#2885ca;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" source="t1_s5" target="t1_s6" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="t1_e_s6_tx" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;rounded=0;html=1;strokeWidth=2;endArrow=block;endFill=1;strokeColor=#43a047;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" source="t1_s6" target="t1_phy_tx" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- ==================== Detail Panel ==================== -->
        <mxCell id="t1_detail" value="&lt;b style=&quot;font-size:13px;color:#333;&quot;&gt;各格式对交换机的处理差异&lt;/b&gt;&lt;hr style=&quot;border:0;border-top:1px solid #E0E0E0;margin:6px 0;&quot;/&gt;&lt;b&gt;Standard&lt;/b&gt;&lt;br&gt;MAC+IP+UDP+RH (50B)&lt;br&gt;QoS: VLAN PCP / DSCP&lt;br&gt;ECN: &lt;font color=&quot;#43a047&quot;&gt;[OK]&lt;/font&gt;&lt;br&gt;拥塞: ECN + PFC + CBFC&lt;hr style=&quot;border:0;border-top:1px solid #E0E0E0;margin:6px 0;&quot;/&gt;&lt;b&gt;AFH_GEN1 / GEN2&lt;/b&gt;&lt;br&gt;AFH MAC+Eth+RH (22B)&lt;br&gt;QoS: VLAN PCP (可选)&lt;br&gt;ECN: &lt;font color=&quot;#d84315&quot;&gt;[FAIL]&lt;/font&gt; 无 IP 头&lt;br&gt;拥塞: PFC + CBFC + Tail Drop&lt;hr style=&quot;border:0;border-top:1px solid #E0E0E0;margin:6px 0;&quot;/&gt;&lt;b&gt;AFH_Lite&lt;/b&gt;&lt;br&gt;AFH MAC only (12B)&lt;br&gt;QoS: 端口默认&lt;br&gt;ECN: &lt;font color=&quot;#d84315&quot;&gt;[FAIL]&lt;/font&gt;&lt;br&gt;重传: &lt;font color=&quot;#d84315&quot;&gt;[FAIL]&lt;/font&gt; Go-Back-N 关闭" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#E0E0E0;fontSize=11;shadow=1;fontColor=#333;align=left;verticalAlign=top;spacingLeft=12;spacingTop=6;spacingRight=8;" vertex="1" parent="1">
          <mxGeometry x="530" y="50" width="370" height="310" as="geometry"/>
        </mxCell>

        <!-- Dashed connector to detail -->
        <mxCell id="t1_dash1" style="dashed=1;dashPattern=5 5;strokeColor=#BDBDBD;endArrow=none;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.3;entryDx=0;entryDy=0;" edge="1" source="t1_s1" target="t1_detail" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- ==================== Bottom Note ==================== -->
        <mxCell id="t1_note" value="&lt;font color=&quot;#666&quot;&gt;延迟: T_switch = T_ingress (50-200ns) + T_queueing (0~us) + T_crossbar (10-50ns) + T_egress (帧大小相关)&lt;/font&gt;" style="text;html=1;align=center;fontSize=11;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="100" y="545" width="600" height="24" as="geometry"/>
        </mxCell>

        <!-- ==================== Legend ==================== -->
        <mxCell id="t1_leg_bg" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fafafa;strokeColor=#E0E0E0;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="30" y="575" width="700" height="30" as="geometry"/>
        </mxCell>
        <mxCell id="t1_leg1" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d6e9f8;strokeColor=#2885ca;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="40" y="580" width="20" height="16" as="geometry"/>
        </mxCell>
        <mxCell id="t1_leg1t" value="Ingress / 通用" style="text;html=1;align=left;fontSize=10;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="65" y="578" width="80" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="t1_leg2" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fef3e0;strokeColor=#e8a838;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="160" y="580" width="20" height="16" as="geometry"/>
        </mxCell>
        <mxCell id="t1_leg2t" value="Crossbar / 调度" style="text;html=1;align=left;fontSize=10;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="185" y="578" width="90" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="t1_leg3" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e2f0e2;strokeColor=#43a047;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="290" y="580" width="20" height="16" as="geometry"/>
        </mxCell>
        <mxCell id="t1_leg3t" value="Egress / 成功" style="text;html=1;align=left;fontSize=10;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="315" y="578" width="80" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="t1_leg4" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fbe9e7;strokeColor=#d84315;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="410" y="580" width="20" height="16" as="geometry"/>
        </mxCell>
        <mxCell id="t1_leg4t" value="PFC / 阻塞 / 丢弃" style="text;html=1;align=left;fontSize=10;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="435" y="578" width="100" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="t1_leg5" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#E0E0E0;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="550" y="580" width="20" height="16" as="geometry"/>
        </mxCell>
        <mxCell id="t1_leg5t" value="Detail Panel" style="text;html=1;align=left;fontSize=10;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="575" y="578" width="80" height="20" as="geometry"/>
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>

  <diagram id="voq-qos" name="5.3 VOQ + QoS">
    <mxGraphModel dx="1100" dy="620" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1100" pageHeight="620" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- Title -->
        <mxCell id="t2_title" value="5.3 VOQ + QoS - 虚拟输出队列与服务质量映射" style="text;html=1;align=center;fontSize=16;fontColor=#333;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="220" y="10" width="450" height="30" as="geometry"/>
        </mxCell>

        <!-- ==================== Left Section: QoS Mapping Flow ==================== -->

        <!-- Step 1: Packet arrives -->
        <mxCell id="t2_pkt" value="&lt;b&gt;PAXI 报文到达&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d6e9f8;strokeColor=#2885ca;fontSize=12;shadow=1;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="60" y="60" width="160" height="44" as="geometry"/>
        </mxCell>

        <!-- Diamond: VLAN? -->
        <mxCell id="t2_diamond" value="&lt;b&gt;有 VLAN?&lt;/b&gt;" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fef3e0;strokeColor=#e8a838;fontSize=12;shadow=1;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="80" y="130" width="120" height="70" as="geometry"/>
        </mxCell>

        <!-- Arrow: pkt -> diamond -->
        <mxCell id="t2_e_pkt_dia" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;rounded=0;html=1;strokeWidth=2;endArrow=block;endFill=1;strokeColor=#2885ca;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" source="t2_pkt" target="t2_diamond" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Yes path: VLAN PCP -->
        <mxCell id="t2_vlan_pcp" value="&lt;b&gt;提取 VLAN PCP&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#666&quot; style=&quot;font-size:10px;&quot;&gt;PCP[2:0] -&amp;gt; 优先级&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e2f0e2;strokeColor=#43a047;fontSize=12;shadow=1;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="240" y="115" width="160" height="44" as="geometry"/>
        </mxCell>

        <!-- No path: Port default -->
        <mxCell id="t2_port_def" value="&lt;b&gt;端口默认优先级&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#666&quot; style=&quot;font-size:10px;&quot;&gt;所有帧同一队列&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fbe9e7;strokeColor=#d84315;fontSize=12;shadow=1;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="240" y="180" width="160" height="44" as="geometry"/>
        </mxCell>

        <!-- VOQ enqueue -->
        <mxCell id="t2_voq" value="&lt;b&gt;VOQ[in][out][pri]&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d6e9f8;strokeColor=#2885ca;fontSize=12;shadow=1;fontColor=#333;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="460" y="145" width="170" height="44" as="geometry"/>
        </mxCell>

        <!-- Diamond -> VLAN PCP (Yes) -->
        <mxCell id="t2_e_dia_yes" value="&lt;font color=&quot;#43a047&quot; style=&quot;font-size:10px;&quot;&gt;是&lt;/font&gt;" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;rounded=0;html=1;strokeWidth=2;endArrow=block;endFill=1;strokeColor=#43a047;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" source="t2_diamond" target="t2_vlan_pcp" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Diamond -> Port default (No) -->
        <mxCell id="t2_e_dia_no" value="&lt;font color=&quot;#d84315&quot; style=&quot;font-size:10px;&quot;&gt;否 (AFH_Lite)&lt;/font&gt;" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;rounded=0;html=1;strokeWidth=2;endArrow=block;endFill=1;strokeColor=#d84315;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" source="t2_diamond" target="t2_port_def" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- VLAN PCP -> VOQ -->
        <mxCell id="t2_e_pcp_voq" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;rounded=0;html=1;strokeWidth=2;endArrow=block;endFill=1;strokeColor=#2885ca;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.35;entryDx=0;entryDy=0;" edge="1" source="t2_vlan_pcp" target="t2_voq" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Port default -> VOQ -->
        <mxCell id="t2_e_def_voq" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;rounded=0;html=1;strokeWidth=2;endArrow=block;endFill=1;strokeColor=#2885ca;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.65;entryDx=0;entryDy=0;" edge="1" source="t2_port_def" target="t2_voq" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- ==================== Priority Assignment Section ==================== -->
        <mxCell id="t2_pri_label" value="&lt;b style=&quot;color:#333;font-size:13px;&quot;&gt;优先级分配&lt;/b&gt;" style="text;html=1;align=left;fontSize=13;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="60" y="240" width="120" height="24" as="geometry"/>
        </mxCell>

        <!-- Pri 3 -->
        <mxCell id="t2_pri3" value="&lt;b&gt;Pri 3 (高): TYPE1 ACK + CNP&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#666&quot; style=&quot;font-size:10px;&quot;&gt;控制帧优先, 保证时效&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fbe9e7;strokeColor=#d84315;fontSize=12;shadow=1;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="60" y="270" width="240" height="50" as="geometry"/>
        </mxCell>

        <!-- Pri 2 -->
        <mxCell id="t2_pri2" value="&lt;b&gt;Pri 2 (中): TYPE1 REQ&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#666&quot; style=&quot;font-size:10px;&quot;&gt;主要数据流量&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fef3e0;strokeColor=#e8a838;fontSize=12;shadow=1;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="60" y="330" width="240" height="50" as="geometry"/>
        </mxCell>

        <!-- Pri 1 -->
        <mxCell id="t2_pri1" value="&lt;b&gt;Pri 1 (低): TYPE1 RSP&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#666&quot; style=&quot;font-size:10px;&quot;&gt;独立隔离防 REQ-RSP 死锁&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d6e9f8;strokeColor=#2885ca;fontSize=12;shadow=1;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="60" y="390" width="240" height="50" as="geometry"/>
        </mxCell>

        <!-- Pri 0 -->
        <mxCell id="t2_pri0" value="&lt;b&gt;Pri 0 (BE): TYPE2 / TYPE3&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#666&quot; style=&quot;font-size:10px;&quot;&gt;多播和管理流量&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e2f0e2;strokeColor=#43a047;fontSize=12;shadow=1;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="60" y="450" width="240" height="50" as="geometry"/>
        </mxCell>

        <!-- ==================== VOQ Structure Grid ==================== -->
        <mxCell id="t2_voq_label" value="&lt;b style=&quot;color:#333;font-size:13px;&quot;&gt;VOQ 矩阵结构&lt;/b&gt;" style="text;html=1;align=left;fontSize=13;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="400" y="240" width="140" height="24" as="geometry"/>
        </mxCell>

        <!-- Output port 0 group -->
        <mxCell id="t2_out0_label" value="&lt;font color=&quot;#666&quot;&gt;-&amp;gt; 出口 0&lt;/font&gt;" style="text;html=1;align=left;fontSize=10;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="400" y="270" width="70" height="18" as="geometry"/>
        </mxCell>
        <mxCell id="t2_voq_0_3" value="Pri 3" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fbe9e7;strokeColor=#d84315;fontSize=9;shadow=0;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="480" y="268" width="60" height="22" as="geometry"/>
        </mxCell>
        <mxCell id="t2_voq_0_2" value="Pri 2" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fef3e0;strokeColor=#e8a838;fontSize=9;shadow=0;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="545" y="268" width="60" height="22" as="geometry"/>
        </mxCell>
        <mxCell id="t2_voq_0_1" value="Pri 1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d6e9f8;strokeColor=#2885ca;fontSize=9;shadow=0;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="610" y="268" width="60" height="22" as="geometry"/>
        </mxCell>
        <mxCell id="t2_voq_0_0" value="Pri 0" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e2f0e2;strokeColor=#43a047;fontSize=9;shadow=0;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="675" y="268" width="60" height="22" as="geometry"/>
        </mxCell>

        <!-- Output port 1 group -->
        <mxCell id="t2_out1_label" value="&lt;font color=&quot;#666&quot;&gt;-&amp;gt; 出口 1&lt;/font&gt;" style="text;html=1;align=left;fontSize=10;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="400" y="300" width="70" height="18" as="geometry"/>
        </mxCell>
        <mxCell id="t2_voq_1_3" value="Pri 3" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fbe9e7;strokeColor=#d84315;fontSize=9;shadow=0;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="480" y="298" width="60" height="22" as="geometry"/>
        </mxCell>
        <mxCell id="t2_voq_1_2" value="Pri 2" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fef3e0;strokeColor=#e8a838;fontSize=9;shadow=0;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="545" y="298" width="60" height="22" as="geometry"/>
        </mxCell>
        <mxCell id="t2_voq_1_1" value="Pri 1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d6e9f8;strokeColor=#2885ca;fontSize=9;shadow=0;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="610" y="298" width="60" height="22" as="geometry"/>
        </mxCell>
        <mxCell id="t2_voq_1_0" value="Pri 0" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e2f0e2;strokeColor=#43a047;fontSize=9;shadow=0;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="675" y="298" width="60" height="22" as="geometry"/>
        </mxCell>

        <!-- Ellipsis -->
        <mxCell id="t2_voq_dots" value="&lt;font color=&quot;#999&quot;&gt;...&lt;/font&gt;" style="text;html=1;align=center;fontSize=14;fontColor=#999;" vertex="1" parent="1">
          <mxGeometry x="560" y="325" width="40" height="20" as="geometry"/>
        </mxCell>

        <!-- Output port N group -->
        <mxCell id="t2_outN_label" value="&lt;font color=&quot;#666&quot;&gt;-&amp;gt; 出口 N&lt;/font&gt;" style="text;html=1;align=left;fontSize=10;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="400" y="350" width="70" height="18" as="geometry"/>
        </mxCell>
        <mxCell id="t2_voq_N_3" value="Pri 3" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fbe9e7;strokeColor=#d84315;fontSize=9;shadow=0;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="480" y="348" width="60" height="22" as="geometry"/>
        </mxCell>
        <mxCell id="t2_voq_N_2" value="Pri 2" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fef3e0;strokeColor=#e8a838;fontSize=9;shadow=0;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="545" y="348" width="60" height="22" as="geometry"/>
        </mxCell>
        <mxCell id="t2_voq_N_1" value="Pri 1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d6e9f8;strokeColor=#2885ca;fontSize=9;shadow=0;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="610" y="348" width="60" height="22" as="geometry"/>
        </mxCell>
        <mxCell id="t2_voq_N_0" value="Pri 0" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e2f0e2;strokeColor=#43a047;fontSize=9;shadow=0;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="675" y="348" width="60" height="22" as="geometry"/>
        </mxCell>

        <!-- VOQ matrix border -->
        <mxCell id="t2_voq_border" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#BDBDBD;dashed=1;dashPattern=5 5;" vertex="1" parent="1">
          <mxGeometry x="470" y="258" width="275" height="122" as="geometry"/>
        </mxCell>

        <!-- ==================== Bottom Annotation ==================== -->
        <mxCell id="t2_bottom" value="&lt;font color=&quot;#666&quot;&gt;总 VOQ 数 = N_in x N_out x N_pri (8x8x4=256, 32x32x8=8192)&lt;/font&gt;" style="text;html=1;align=center;fontSize=11;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="200" y="520" width="500" height="24" as="geometry"/>
        </mxCell>

        <!-- ==================== Legend ==================== -->
        <mxCell id="t2_leg_bg" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fafafa;strokeColor=#E0E0E0;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="30" y="575" width="700" height="30" as="geometry"/>
        </mxCell>
        <mxCell id="t2_leg1" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d6e9f8;strokeColor=#2885ca;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="40" y="580" width="20" height="16" as="geometry"/>
        </mxCell>
        <mxCell id="t2_leg1t" value="Ingress / 通用" style="text;html=1;align=left;fontSize=10;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="65" y="578" width="80" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="t2_leg2" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fef3e0;strokeColor=#e8a838;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="160" y="580" width="20" height="16" as="geometry"/>
        </mxCell>
        <mxCell id="t2_leg2t" value="Crossbar / 调度" style="text;html=1;align=left;fontSize=10;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="185" y="578" width="90" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="t2_leg3" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e2f0e2;strokeColor=#43a047;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="290" y="580" width="20" height="16" as="geometry"/>
        </mxCell>
        <mxCell id="t2_leg3t" value="Egress / 成功" style="text;html=1;align=left;fontSize=10;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="315" y="578" width="80" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="t2_leg4" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fbe9e7;strokeColor=#d84315;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="410" y="580" width="20" height="16" as="geometry"/>
        </mxCell>
        <mxCell id="t2_leg4t" value="PFC / 阻塞 / 丢弃" style="text;html=1;align=left;fontSize=10;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="435" y="578" width="100" height="20" as="geometry"/>
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>

  <diagram id="buffer-dt" name="5.5 Buffer + DT">
    <mxGraphModel dx="1100" dy="560" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1100" pageHeight="560" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- Title -->
        <mxCell id="t3_title" value="5.5 Buffer + DT - 共享缓冲池与动态阈值算法" style="text;html=1;align=center;fontSize=16;fontColor=#333;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="220" y="10" width="450" height="30" as="geometry"/>
        </mxCell>

        <!-- ==================== Top Section: Shared Buffer ==================== -->
        <mxCell id="t3_pool" value="&lt;b style=&quot;font-size:14px;&quot;&gt;Shared Memory Pool&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#666&quot; style=&quot;font-size:10px;&quot;&gt;Total: B bytes, 典型 16~64 MB&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d6e9f8;strokeColor=#2885ca;fontSize=12;shadow=1;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="250" y="55" width="350" height="50" as="geometry"/>
        </mxCell>

        <mxCell id="t3_alloc" value="&lt;b&gt;Dynamic Allocation (DT)&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d6e9f8;strokeColor=#2885ca;fontSize=12;shadow=1;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="330" y="130" width="180" height="44" as="geometry"/>
        </mxCell>

        <!-- Arrow: Pool -> Alloc -->
        <mxCell id="t3_e_pool_alloc" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;rounded=0;html=1;strokeWidth=2;endArrow=block;endFill=1;strokeColor=#2885ca;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" source="t3_pool" target="t3_alloc" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Fan-out VOQ boxes -->
        <mxCell id="t3_voq_00" value="&lt;font style=&quot;font-size:9px;&quot;&gt;VOQ[0][0]&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d6e9f8;strokeColor=#2885ca;fontSize=9;shadow=0;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="180" y="200" width="80" height="30" as="geometry"/>
        </mxCell>
        <mxCell id="t3_voq_01" value="&lt;font style=&quot;font-size:9px;&quot;&gt;VOQ[0][1]&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d6e9f8;strokeColor=#2885ca;fontSize=9;shadow=0;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="280" y="200" width="80" height="30" as="geometry"/>
        </mxCell>
        <mxCell id="t3_voq_dots" value="&lt;font color=&quot;#999&quot;&gt;...&lt;/font&gt;" style="text;html=1;align=center;fontSize=14;fontColor=#999;" vertex="1" parent="1">
          <mxGeometry x="390" y="200" width="60" height="30" as="geometry"/>
        </mxCell>
        <mxCell id="t3_voq_NN" value="&lt;font style=&quot;font-size:9px;&quot;&gt;VOQ[N][N]&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d6e9f8;strokeColor=#2885ca;fontSize=9;shadow=0;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="480" y="200" width="80" height="30" as="geometry"/>
        </mxCell>

        <!-- Fan-out arrows -->
        <mxCell id="t3_e_alloc_v00" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;rounded=0;html=1;strokeWidth=1;endArrow=block;endFill=1;strokeColor=#2885ca;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" source="t3_alloc" target="t3_voq_00" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="t3_e_alloc_v01" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;rounded=0;html=1;strokeWidth=1;endArrow=block;endFill=1;strokeColor=#2885ca;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" source="t3_alloc" target="t3_voq_01" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="t3_e_alloc_vNN" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;rounded=0;html=1;strokeWidth=1;endArrow=block;endFill=1;strokeColor=#2885ca;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" source="t3_alloc" target="t3_voq_NN" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- ==================== Bottom Section: DT Algorithm ==================== -->
        <mxCell id="t3_dt_region" value="&lt;b style=&quot;color:#e8a838;font-size:13px;&quot;&gt;DT 算法入队判断&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fef3e0;fillOpacity=10;strokeColor=#e8a838;dashed=1;dashPattern=8 4;verticalAlign=top;spacingTop=4;align=left;spacingLeft=10;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="20" y="260" width="710" height="250" as="geometry"/>
        </mxCell>

        <!-- Static Reserved -->
        <mxCell id="t3_static" value="&lt;b&gt;Static_Reserved = S&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#666&quot; style=&quot;font-size:10px;&quot;&gt;保底缓冲, 如 128 KB/VOQ&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fef3e0;strokeColor=#e8a838;fontSize=12;shadow=1;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="50" y="300" width="200" height="44" as="geometry"/>
        </mxCell>

        <!-- Shared Available -->
        <mxCell id="t3_shared" value="&lt;b&gt;Shared_Available&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#666&quot; style=&quot;font-size:10px;&quot;&gt;= B - sum(all_used)&lt;br&gt;全局剩余共享缓冲&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fef3e0;strokeColor=#e8a838;fontSize=12;shadow=1;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="50" y="370" width="220" height="50" as="geometry"/>
        </mxCell>

        <!-- Dynamic Quota -->
        <mxCell id="t3_quota" value="&lt;b&gt;Dynamic_Quota&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#666&quot; style=&quot;font-size:10px;&quot;&gt;= alpha x Shared_Available&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fef3e0;strokeColor=#e8a838;fontSize=12;shadow=1;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="320" y="370" width="220" height="44" as="geometry"/>
        </mxCell>

        <!-- Max Allowed -->
        <mxCell id="t3_max" value="&lt;b&gt;Max_Allowed&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#666&quot; style=&quot;font-size:10px;&quot;&gt;= S + Dynamic_Quota&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e2f0e2;strokeColor=#43a047;fontSize=12;shadow=1;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="320" y="305" width="220" height="44" as="geometry"/>
        </mxCell>

        <!-- Arrows: Static -> Max_Allowed -->
        <mxCell id="t3_e_static_max" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;rounded=0;html=1;strokeWidth=2;endArrow=block;endFill=1;strokeColor=#e8a838;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" source="t3_static" target="t3_max" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Arrows: Shared -> Quota -->
        <mxCell id="t3_e_shared_quota" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;rounded=0;html=1;strokeWidth=2;endArrow=block;endFill=1;strokeColor=#e8a838;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" source="t3_shared" target="t3_quota" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Arrows: Quota -> Max_Allowed -->
        <mxCell id="t3_e_quota_max" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;rounded=0;html=1;strokeWidth=2;endArrow=block;endFill=1;strokeColor=#43a047;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" source="t3_quota" target="t3_max" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Diamond: check -->
        <mxCell id="t3_check" value="&lt;b style=&quot;font-size:11px;&quot;&gt;VOQ.used&lt;br&gt;&amp;lt; Max_Allowed?&lt;/b&gt;" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fef3e0;strokeColor=#e8a838;fontSize=11;shadow=1;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="370" y="430" width="130" height="70" as="geometry"/>
        </mxCell>

        <!-- Arrow: Max_Allowed -> check (conceptual) -->
        <mxCell id="t3_e_max_check" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;rounded=0;html=1;strokeWidth=2;endArrow=block;endFill=1;strokeColor=#e8a838;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" source="t3_max" target="t3_check" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="430" y="420"/>
              <mxPoint x="435" y="420"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Allow -->
        <mxCell id="t3_allow" value="&lt;b&gt;允许入队&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e2f0e2;strokeColor=#43a047;fontSize=12;shadow=1;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="210" y="445" width="120" height="40" as="geometry"/>
        </mxCell>

        <!-- Drop -->
        <mxCell id="t3_drop" value="&lt;b&gt;Tail Drop / PFC&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fbe9e7;strokeColor=#d84315;fontSize=12;shadow=1;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="550" y="445" width="140" height="40" as="geometry"/>
        </mxCell>

        <!-- Diamond -> Allow (Yes) -->
        <mxCell id="t3_e_check_allow" value="&lt;font color=&quot;#43a047&quot; style=&quot;font-size:10px;&quot;&gt;是&lt;/font&gt;" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;rounded=0;html=1;strokeWidth=2;endArrow=block;endFill=1;strokeColor=#43a047;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" source="t3_check" target="t3_allow" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Diamond -> Drop (No) -->
        <mxCell id="t3_e_check_drop" value="&lt;font color=&quot;#d84315&quot; style=&quot;font-size:10px;&quot;&gt;否&lt;/font&gt;" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;rounded=0;html=1;strokeWidth=2;endArrow=block;endFill=1;strokeColor=#d84315;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" source="t3_check" target="t3_drop" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- ==================== Detail Panel ==================== -->
        <mxCell id="t3_detail" value="&lt;b style=&quot;font-size:12px;color:#333;&quot;&gt;alpha 参数&lt;/b&gt;&lt;hr style=&quot;border:0;border-top:1px solid #E0E0E0;margin:6px 0;&quot;/&gt;&lt;font color=&quot;#666&quot;&gt;alpha &amp;lt; 1: 保守 (限制单 VOQ)&lt;br&gt;&lt;br&gt;alpha = 1: 均衡 (默认推荐)&lt;br&gt;&lt;br&gt;alpha = 2: 激进 (Incast 吸收)&lt;br&gt;&lt;br&gt;alpha 4~8: 深吸收 (AllReduce)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#E0E0E0;fontSize=11;shadow=1;fontColor=#333;align=left;verticalAlign=top;spacingLeft=12;spacingTop=6;spacingRight=8;" vertex="1" parent="1">
          <mxGeometry x="760" y="260" width="220" height="180" as="geometry"/>
        </mxCell>

        <!-- Dashed connector to detail -->
        <mxCell id="t3_dash1" style="dashed=1;dashPattern=5 5;strokeColor=#BDBDBD;endArrow=none;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.3;entryDx=0;entryDy=0;" edge="1" source="t3_quota" target="t3_detail" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- ==================== Legend ==================== -->
        <mxCell id="t3_leg_bg" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fafafa;strokeColor=#E0E0E0;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="30" y="520" width="700" height="30" as="geometry"/>
        </mxCell>
        <mxCell id="t3_leg1" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d6e9f8;strokeColor=#2885ca;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="40" y="525" width="20" height="16" as="geometry"/>
        </mxCell>
        <mxCell id="t3_leg1t" value="Buffer / VOQ" style="text;html=1;align=left;fontSize=10;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="65" y="523" width="80" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="t3_leg2" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fef3e0;strokeColor=#e8a838;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="160" y="525" width="20" height="16" as="geometry"/>
        </mxCell>
        <mxCell id="t3_leg2t" value="DT 算法" style="text;html=1;align=left;fontSize=10;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="185" y="523" width="60" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="t3_leg3" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e2f0e2;strokeColor=#43a047;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="260" y="525" width="20" height="16" as="geometry"/>
        </mxCell>
        <mxCell id="t3_leg3t" value="允许 / 阈值" style="text;html=1;align=left;fontSize=10;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="285" y="523" width="80" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="t3_leg4" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fbe9e7;strokeColor=#d84315;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="380" y="525" width="20" height="16" as="geometry"/>
        </mxCell>
        <mxCell id="t3_leg4t" value="丢弃 / PFC" style="text;html=1;align=left;fontSize=10;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="405" y="523" width="80" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="t3_leg5" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#E0E0E0;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="500" y="525" width="20" height="16" as="geometry"/>
        </mxCell>
        <mxCell id="t3_leg5t" value="Detail Panel" style="text;html=1;align=left;fontSize=10;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="525" y="523" width="80" height="20" as="geometry"/>
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>

  <diagram id="egress-sched" name="5.6 Egress Scheduling">
    <mxGraphModel dx="1100" dy="420" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1100" pageHeight="420" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- Title -->
        <mxCell id="t4_title" value="5.6 Egress Scheduling - 出口调度: SP + WRR 混合" style="text;html=1;align=center;fontSize=16;fontColor=#333;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="180" y="10" width="420" height="30" as="geometry"/>
        </mxCell>

        <!-- ==================== Main flow ==================== -->
        <mxCell id="t4_output" value="&lt;b&gt;出口端口调度&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d6e9f8;strokeColor=#2885ca;fontSize=12;shadow=1;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="200" y="55" width="220" height="44" as="geometry"/>
        </mxCell>

        <!-- ==================== SP Region ==================== -->
        <mxCell id="t4_sp_region" value="&lt;b style=&quot;color:#d84315;font-size:13px;&quot;&gt;SP 层: 严格优先级&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fbe9e7;fillOpacity=10;strokeColor=#d84315;dashed=1;dashPattern=8 4;verticalAlign=top;spacingTop=4;align=left;spacingLeft=10;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="30" y="130" width="490" height="90" as="geometry"/>
        </mxCell>

        <!-- Pri 3: SP -->
        <mxCell id="t4_sp_pri3" value="&lt;b&gt;Pri 3: ACK + CNP&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#666&quot; style=&quot;font-size:10px;&quot;&gt;绝对优先, 帧小 &amp;lt;54B, 流量占比 &amp;lt;5%&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fbe9e7;strokeColor=#d84315;fontSize=12;shadow=1;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="60" y="160" width="300" height="50" as="geometry"/>
        </mxCell>

        <!-- Arrow: output -> SP region -->
        <mxCell id="t4_e_out_sp" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;rounded=0;html=1;strokeWidth=2;endArrow=block;endFill=1;strokeColor=#2885ca;exitX=0.3;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" source="t4_output" target="t4_sp_pri3" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- ==================== WRR Region ==================== -->
        <mxCell id="t4_wrr_region" value="&lt;b style=&quot;color:#e8a838;font-size:13px;&quot;&gt;WRR 层: 加权轮转 (数据流量)&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fef3e0;fillOpacity=10;strokeColor=#e8a838;dashed=1;dashPattern=8 4;verticalAlign=top;spacingTop=4;align=left;spacingLeft=10;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="30" y="250" width="490" height="100" as="geometry"/>
        </mxCell>

        <!-- Pri 2: WRR REQ -->
        <mxCell id="t4_wrr_pri2" value="&lt;b&gt;Pri 2: REQ&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#666&quot; style=&quot;font-size:10px;&quot;&gt;权重 50%&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fef3e0;strokeColor=#e8a838;fontSize=12;shadow=1;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="40" y="290" width="140" height="50" as="geometry"/>
        </mxCell>

        <!-- Pri 1: WRR RSP -->
        <mxCell id="t4_wrr_pri1" value="&lt;b&gt;Pri 1: RSP&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#666&quot; style=&quot;font-size:10px;&quot;&gt;权重 40%&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d6e9f8;strokeColor=#2885ca;fontSize=12;shadow=1;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="200" y="290" width="140" height="50" as="geometry"/>
        </mxCell>

        <!-- Pri 0: WRR MUL -->
        <mxCell id="t4_wrr_pri0" value="&lt;b&gt;Pri 0: MUL/TYPE3&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#666&quot; style=&quot;font-size:10px;&quot;&gt;权重 10%&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e2f0e2;strokeColor=#43a047;fontSize=12;shadow=1;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="360" y="290" width="140" height="50" as="geometry"/>
        </mxCell>

        <!-- Arrow: output -> WRR region -->
        <mxCell id="t4_e_out_wrr" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;rounded=0;html=1;strokeWidth=2;endArrow=block;endFill=1;strokeColor=#2885ca;exitX=0.7;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" source="t4_output" target="t4_wrr_pri1" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- ==================== Detail Panel ==================== -->
        <mxCell id="t4_detail" value="&lt;b style=&quot;font-size:13px;color:#333;&quot;&gt;设计原因&lt;/b&gt;&lt;hr style=&quot;border:0;border-top:1px solid #E0E0E0;margin:6px 0;&quot;/&gt;&lt;font color=&quot;#666&quot;&gt;&lt;b&gt;ACK/CNP 用 SP:&lt;/b&gt;&lt;br&gt;帧小, 不饥饿其他队列,&lt;br&gt;保证控制帧最低延迟&lt;br&gt;&lt;br&gt;&lt;b&gt;REQ/RSP 用 WRR:&lt;/b&gt;&lt;br&gt;防止 REQ 独占带宽导致&lt;br&gt;RSP 返回受阻&lt;br&gt;&lt;br&gt;&lt;b&gt;RSP 权重略低:&lt;/b&gt;&lt;br&gt;响应通常滞后于请求&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#E0E0E0;fontSize=11;shadow=1;fontColor=#333;align=left;verticalAlign=top;spacingLeft=12;spacingTop=6;spacingRight=8;" vertex="1" parent="1">
          <mxGeometry x="560" y="110" width="340" height="230" as="geometry"/>
        </mxCell>

        <!-- Dashed connector to detail from SP -->
        <mxCell id="t4_dash1" style="dashed=1;dashPattern=5 5;strokeColor=#BDBDBD;endArrow=none;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.2;entryDx=0;entryDy=0;" edge="1" source="t4_sp_pri3" target="t4_detail" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Dashed connector to detail from WRR -->
        <mxCell id="t4_dash2" style="dashed=1;dashPattern=5 5;strokeColor=#BDBDBD;endArrow=none;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.7;entryDx=0;entryDy=0;" edge="1" source="t4_wrr_pri0" target="t4_detail" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- ==================== Legend ==================== -->
        <mxCell id="t4_leg_bg" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fafafa;strokeColor=#E0E0E0;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="30" y="380" width="700" height="30" as="geometry"/>
        </mxCell>
        <mxCell id="t4_leg1" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d6e9f8;strokeColor=#2885ca;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="40" y="385" width="20" height="16" as="geometry"/>
        </mxCell>
        <mxCell id="t4_leg1t" value="通用 / RSP" style="text;html=1;align=left;fontSize=10;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="65" y="383" width="80" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="t4_leg2" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fef3e0;strokeColor=#e8a838;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="160" y="385" width="20" height="16" as="geometry"/>
        </mxCell>
        <mxCell id="t4_leg2t" value="WRR / REQ" style="text;html=1;align=left;fontSize=10;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="185" y="383" width="80" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="t4_leg3" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e2f0e2;strokeColor=#43a047;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="280" y="385" width="20" height="16" as="geometry"/>
        </mxCell>
        <mxCell id="t4_leg3t" value="BE / MUL" style="text;html=1;align=left;fontSize=10;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="305" y="383" width="70" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="t4_leg4" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fbe9e7;strokeColor=#d84315;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="390" y="385" width="20" height="16" as="geometry"/>
        </mxCell>
        <mxCell id="t4_leg4t" value="SP / ACK+CNP" style="text;html=1;align=left;fontSize=10;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="415" y="383" width="90" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="t4_leg5" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#E0E0E0;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="520" y="385" width="20" height="16" as="geometry"/>
        </mxCell>
        <mxCell id="t4_leg5t" value="Detail Panel" style="text;html=1;align=left;fontSize=10;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="545" y="383" width="80" height="20" as="geometry"/>
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>